<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleSAMLphp Documentation</title>

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
</head>
<body>
<header>
 <div id="header">
  <div class="right">
   <form action="https://www.google.com/cse" method="get" style="margin-top: 2.5rem; margin-right: 2rem">
    <input name="cx" type="hidden" value="004202914224971217557:8ks4jjstupq"/>
    <input name="siteurl" type="hidden" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq"/>
    <input name="adkw" type="hidden" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4"/>
    <input name="q" placeholder="Search" type="search" value=""/>
   </form>
  </div>
  <div class="v-center logo-header">
   <div id="logo">
    <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
     <span class="simple">
      Simple
     </span>
     <span class="saml">
      SAML
     </span>
     <span class="simple">
      php
     </span>
    </a>
   </div>
  </div>
 </div>
 <!-- Grey header bar below -->
 <nav>
  <div id="headerbar" style="clear: both">
   <p id="breadcrumb">
    <a href="https://simplesamlphp.org">
     Home
    </a>
    Â» Documentation
   </p>
   <div class="mtoolbar">
    <div class="menuitem">
     <a href="/docs/1.19/index.html">
      1.19
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.18/index.html">
      1.18
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.17/index.html">
      1.17
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.16/index.html">
      1.16
     </a>
    </div>
    <div class="menuitem first">
     <a href="/docs/devel/index.html">
      devel
     </a>
    </div>
    <div class="menuitem last">
     <a href="/docs/contributed_modules.html">
      Contributed modules
     </a>
    </div>
   </div>
   <br style="height: 0px; clear: both"/>
  </div>
  <!-- /#headerbar -->
 </nav>
 <div id="content">
 </div>
</header><main><h1 id="riak-store-module">
 Riak Store module
</h1>
<!--
  This file is written in Markdown syntax.
  For more information about how to use the Markdown syntax, read here:
  http://daringfireball.net/projects/markdown/syntax
-->
<!-- {{TOC}} -->
<h2 id="introduction">
 Introduction
</h2>
<p>
 The riak module implements a Store that can be used as a backend
for SimpleSAMLphp session data like the phpsession, sql, or memcache
backends.
</p>
<h2 id="preparations">
 Preparations
</h2>
<p>
 The obvious first step for using Riak as a backend is to install
and configure a Riak cluster for SimpleSAMLphp to use. Please refer
to the Riak documentation for this.
</p>
<p>
 This module requires the use of a Riak backend that supports secondary
indexes. Refer to the Riak documentation on how to enable an
appropriate backend for use by this module. Currently the only
storage backend that supports secondary indexes is leveldb.
</p>
<p>
 Next, you will need to install the Riak PHP Client library, available
from https://github.com/basho/riak-php-client.
</p>
<p>
 Finally, you need to config SimpleSAMLphp to for the riak Store by
enabling the following modules:
</p>
<ol>
 <li>
  cron
 </li>
 <li>
  riak
 </li>
</ol>
<p>
 The cron module allows you to do tasks regularly by setting up a
cronjob that calls hooks in SimpleSAMLphp. This is required by the
riak module to remove expired entries in the store.
</p>
<p>
 Enabling the riak module allows it to be loaded and used as a storage
backend.
</p>
<p>
 You also need to copy the
 <code>
  config-templates
 </code>
 files from the cron
module above into the global
 <code>
  config/
 </code>
 directory.
</p>
<div class="codehilite">
 <pre><span></span><code>$ <span class="nb">cd</span> /var/simplesamlphp
$ touch modules/cron/enable
$ cp modules/cron/config-templates/*.php config/
$ touch modules/riak/enable
$ cp modules/riak/config-templates/*.php config/
</code></pre>
</div>
<h2 id="configuring-the-cron-module">
 Configuring the cron module
</h2>
<p>
 At
 <code>
  /var/simplesamlphp/config
 </code>
</p>
<div class="codehilite">
 <pre><span></span><code>$ vi module_cron.php
</code></pre>
</div>
<p>
 edit:
</p>
<div class="codehilite">
 <pre><span></span><code>$config = array (
  'key' =&gt; 'secret',
  'allowed_tags' =&gt; array('daily', 'hourly', 'frequent'),
  'debug_message' =&gt; TRUE,
  'sendemail' =&gt; TRUE,
);
</code></pre>
</div>
<p>
 Then: With your browser go to =&gt; https://simplesamlphp_machine/simplesaml/module.php/cron/croninfo.php
</p>
<p>
 And copy the cron's sugestion:
</p>
<div class="codehilite">
 <pre><span></span><code><span class="nb">-------------------------------------------------------------------------------------------------------------------</span><span class="c"></span>
<span class="c">Cron is a way to run things regularly on unix systems</span><span class="nt">.</span><span class="c"></span>

<span class="c">Here is a suggestion for a crontab file:</span>

<span class="c"># Run cron </span><span class="k">[</span><span class="c">daily</span><span class="k">]</span><span class="c"></span>
<span class="c">02 0 * * * curl </span><span class="nb">--</span><span class="c">silent "https://simplesamlphp_machine/simplesaml/module</span><span class="nt">.</span><span class="c">php/cron/cron</span><span class="nt">.</span><span class="c">php?key=secret&amp;tag=daily" </span><span class="nv">&gt;</span><span class="c"> /dev/null 2</span><span class="nv">&gt;</span><span class="c">&amp;1</span>
<span class="c"># Run cron </span><span class="k">[</span><span class="c">hourly</span><span class="k">]</span><span class="c"></span>
<span class="c">01 * * * * curl </span><span class="nb">--</span><span class="c">silent "https://simplesamlphp_machine/simplesaml/module</span><span class="nt">.</span><span class="c">php/cron/cron</span><span class="nt">.</span><span class="c">php?key=secret&amp;tag=hourly" </span><span class="nv">&gt;</span><span class="c"> /dev/null 2</span><span class="nv">&gt;</span><span class="c">&amp;1</span>
<span class="c"># Run cron </span><span class="k">[</span><span class="c">frequent</span><span class="k">]</span><span class="c"></span>
<span class="c">XXXXXXXXXX curl </span><span class="nb">--</span><span class="c">silent "https://simplesamlphp_machine/simplesaml/module</span><span class="nt">.</span><span class="c">php/cron/cron</span><span class="nt">.</span><span class="c">php?key=secret&amp;tag=frequent" </span><span class="nv">&gt;</span><span class="c"> /dev/null 2</span><span class="nv">&gt;</span><span class="c">&amp;1</span>
<span class="c">  Click here to run the cron jobs:</span>

<span class="c">Run cron </span><span class="k">[</span><span class="c">daily</span><span class="k">]</span><span class="c"></span>
<span class="c">Run cron </span><span class="k">[</span><span class="c">hourly</span><span class="k">]</span><span class="c"></span>
<span class="c">Run cron </span><span class="k">[</span><span class="c">frequent</span><span class="k">]</span><span class="c"></span>
<span class="nb">-------------------------------------------------------------------------------------------------------------------</span><span class="c"></span>
</code></pre>
</div>
<p>
 Add to CRON with
</p>
<div class="codehilite">
 <pre><span></span><code># crontab -e
</code></pre>
</div>
<h2 id="configuring-the-riak-module">
 Configuring the riak module
</h2>
<p>
 The riak module uses the following configuration options specified
in
 <code>
  config/module_riak.php
 </code>
 . The defaults are listed:
</p>
<div class="codehilite">
 <pre><span></span><code>$config = array(
  'path' =&gt; 'riak-php-client/riak.php',
  'host' =&gt; 'localhost',
  'port' =&gt; 8098,
  'bucket' =&gt; 'SimpleSAMLphp',
);
</code></pre>
</div>
<p>
 Finally, the module can be specified as the Store in
 <code>
  config/config.php
 </code>
 with the following setting:
</p>
<div class="codehilite">
 <pre><span></span><code>  'store.type' =&gt; 'riak:Store',
</code></pre>
</div></main></body>
</html>
