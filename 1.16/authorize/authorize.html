<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleSAMLphp Documentation</title>

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
</head>
<body>
<header>
 <div id="header">
  <div class="right">
   <form action="https://www.google.com/cse" method="get" style="margin-top: 2.5rem; margin-right: 2rem">
    <input name="cx" type="hidden" value="004202914224971217557:8ks4jjstupq"/>
    <input name="siteurl" type="hidden" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq"/>
    <input name="adkw" type="hidden" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4"/>
    <input name="q" placeholder="Search" type="search" value=""/>
   </form>
  </div>
  <div class="v-center logo-header">
   <div id="logo">
    <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
     <span class="simple">
      Simple
     </span>
     <span class="saml">
      SAML
     </span>
     <span class="simple">
      php
     </span>
    </a>
   </div>
  </div>
 </div>
 <!-- Grey header bar below -->
 <nav>
  <div id="headerbar" style="clear: both">
   <p id="breadcrumb">
    <a href="https://simplesamlphp.org">
     Home
    </a>
    Â» Documentation
   </p>
   <div class="mtoolbar">
    <div class="menuitem">
     <a href="/docs/2.0/index.html">
      2.0 (stable)
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.19/index.html">
      1.19
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.18/index.html">
      1.18
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.17/index.html">
      1.17
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.16/index.html">
      1.16
     </a>
    </div>
    <div class="menuitem first">
     <a href="/docs/devel/index.html">
      devel
     </a>
    </div>
    <div class="menuitem last">
     <a href="/docs/contributed_modules.html">
      Contributed modules
     </a>
    </div>
   </div>
   <br style="height: 0px; clear: both"/>
  </div>
  <!-- /#headerbar -->
 </nav>
 <div id="content">
 </div>
</header><main><h1 id="authorize-module">
 authorize Module
</h1>
<!--
  This file is written in Markdown syntax.
  For more information about how to use the Markdown syntax, read here:
  http://daringfireball.net/projects/markdown/syntax
-->
<div class="codehilite">
 <pre><span></span><code><span class="o">*</span><span class="w"> </span><span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Ernesto</span><span class="w"> </span><span class="n">Revilla</span><span class="w"> </span><span class="o">&lt;</span><span class="n">erny</span><span class="nv">@yaco</span><span class="p">.</span><span class="n">es</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Yaco</span><span class="w"> </span><span class="n">Sistemas</span><span class="p">,</span><span class="w"> </span><span class="n">Ryan</span><span class="w"> </span><span class="n">Panning</span>
<span class="o">*</span><span class="w"> </span><span class="nl">Package</span><span class="p">:</span><span class="w"> </span><span class="n">SimpleSAMLphp</span>
</code></pre>
</div>
<p>
 This module provides a user authorization filter based on attribute matching for those applications that do not cleanly separate authentication from authorization and set some default permissions for authenticated users.
</p>
<dl>
 <dt>
  <code>
   authorize:Authorize
  </code>
 </dt>
 <dd>
  Authorize certain users based on attribute matching
 </dd>
</dl>
<h2 id="authorizeauthorize">
 <code>
  authorize:Authorize
 </code>
</h2>
<p>
 There are two configuration options that can be defined; deny and regex. All other filter configuration options are considered attribute matching rules.
</p>
<p>
 The users not authorized will be shown a 403 Forbidden page.
</p>
<h3 id="deny">
 Deny
</h3>
<p>
 The default action of the filter is to authorize only if an attribute match is found (default allow). When set to TRUE, this option reverses that rule and authorizes the user unless an attribute match is found (default deny), causing an unauthorized action.
</p>
<p>
 Note: This option needs to be boolean (TRUE/FALSE) else it will be considered an attribute matching rule.
</p>
<h3 id="regex">
 Regex
</h3>
<p>
 Turn regex pattern matching on or off for the attribute values defined. For backwards compatibility, this option defaults to TRUE, but can be turned off by setting it to FALSE.
</p>
<p>
 Note: This option needs to be boolean (TRUE/FALSE) else it will be considered an attribute matching rule.
</p>
<h3 id="attribute-rules">
 Attribute Rules
</h3>
<p>
 Each additional filter configuration option is considered an attribute matching rule. For each attribute, you can specify a string or array of strings to match. If one of those attributes match one of the rules (OR operator), the user is authorized/unauthorized (depending on the deny config option).
</p>
<p>
 Note: If regex is enabled, you must use the preg_match format, i.e. you have to enclose it with a delimiter that does not appear inside the regex (e.g. slash (/), at sign (@), number sign (#) or underscore (
 <code>
  _
 </code>
 )).
</p>
<h3 id="problems">
 Problems
</h3>
<ul>
 <li>
  Once you get the forbidden page, you can't logout at the IdP directly,
   (as far as I know), you have to close the browser.
 </li>
</ul>
<h3 id="examples">
 Examples
</h3>
<p>
 To use this filter configure it in
 <code>
  config/config.php
 </code>
 :
</p>
<div class="codehilite">
 <pre><span></span><code><span class="s1">'authproc.sp'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">array</span><span class="p">(</span>
<span class="w">  </span><span class="mi">60</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">array</span><span class="p">(</span>
<span class="w">    </span><span class="s1">'class'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">'authorize:Authorize'</span><span class="p">,</span>
<span class="w">    </span><span class="s1">'uid'</span><span class="w">   </span><span class="o">=&gt;</span><span class="w">  </span><span class="k">array</span><span class="p">(</span>
<span class="w">      </span><span class="s1">'/.*@example.com/'</span><span class="p">,</span>
<span class="w">      </span><span class="s1">'/(user1|user2|user3)@example.edu/'</span><span class="p">,</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="s1">'schacUserStatus'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">'@urn:mace:terena.org:userStatus:'</span><span class="w"> </span><span class="p">.</span>
<span class="w">      </span><span class="s1">'example.org:service:active.*@'</span><span class="p">,</span>
<span class="p">)</span>
</code></pre>
</div>
<p>
 An alternate way of using this filter is to deny certain users. Or even use multiple filters to create a simple ACL, by first allowing a group of users but then denying a "black list" of users.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="s1">'authproc.sp'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">array</span><span class="p">(</span>
<span class="w">  </span><span class="mi">60</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">array</span><span class="p">(</span>
<span class="w">    </span><span class="s1">'class'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s1">'authorize:Authorize'</span><span class="p">,</span>
<span class="w">    </span><span class="s1">'deny'</span><span class="w">  </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">TRUE</span><span class="p">,</span>
<span class="w">    </span><span class="s1">'uid'</span><span class="w">   </span><span class="o">=&gt;</span><span class="w">  </span><span class="k">array</span><span class="p">(</span>
<span class="w">      </span><span class="s1">'/.*@students.example.edu/'</span><span class="p">,</span>
<span class="w">      </span><span class="s1">'/(stu1|stu2|stu3)@example.edu/'</span><span class="p">,</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">)</span>
</code></pre>
</div>
<p>
 The regex pattern matching can be turned off, allowing for exact attribute matching rules. This can be helpful in cases where you know what the value should be. An example of this is with the memberOf attribute or using the ldap:AttributeAddUsersGroups filter with the group attribute.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="p">'</span><span class="n">authproc</span><span class="p">.</span><span class="n">sp</span><span class="p">'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">array</span><span class="p">(</span>
<span class="w">  </span><span class="mh">60</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">array</span><span class="p">(</span>
<span class="w">    </span><span class="p">'</span><span class="n">class</span><span class="p">'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">'</span><span class="nl">authorize:</span><span class="n">Authorize</span><span class="p">',</span>
<span class="w">    </span><span class="p">'</span><span class="n">regex</span><span class="p">'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">FALSE</span><span class="p">,</span>
<span class="w">    </span><span class="p">'</span><span class="n">group</span><span class="p">'</span><span class="w"> </span><span class="o">=&gt;</span><span class="w">  </span><span class="n">array</span><span class="p">(</span>
<span class="w">      </span><span class="p">'</span><span class="n">CN</span><span class="o">=</span><span class="n">SimpleSAML</span><span class="w"> </span><span class="n">Students</span><span class="p">,</span><span class="n">CN</span><span class="o">=</span><span class="n">Users</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">edu</span><span class="p">',</span>
<span class="w">      </span><span class="p">'</span><span class="n">CN</span><span class="o">=</span><span class="n">All</span><span class="w"> </span><span class="n">Teachers</span><span class="p">,</span><span class="n">OU</span><span class="o">=</span><span class="n">Staff</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">example</span><span class="p">,</span><span class="n">DC</span><span class="o">=</span><span class="n">edu</span><span class="p">',</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">)</span>
</code></pre>
</div></main></body>
</html>
