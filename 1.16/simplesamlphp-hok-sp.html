<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleSAMLphp Documentation</title>

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
</head>
<body>
<header>
 <div id="header">
  <div class="right">
   <form action="https://www.google.com/cse" method="get" style="margin-top: 2.5rem; margin-right: 2rem">
    <input name="cx" type="hidden" value="004202914224971217557:8ks4jjstupq"/>
    <input name="siteurl" type="hidden" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq"/>
    <input name="adkw" type="hidden" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4"/>
    <input name="q" placeholder="Search" type="search" value=""/>
   </form>
  </div>
  <div class="v-center logo-header">
   <div id="logo">
    <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
     <span class="simple">
      Simple
     </span>
     <span class="saml">
      SAML
     </span>
     <span class="simple">
      php
     </span>
    </a>
   </div>
  </div>
 </div>
 <!-- Grey header bar below -->
 <nav>
  <div id="headerbar" style="clear: both">
   <p id="breadcrumb">
    <a href="https://simplesamlphp.org">
     Home
    </a>
    Â» Documentation
   </p>
   <div class="mtoolbar">
    <div class="menuitem first">
     <a href="/docs/latest/index.html">
      latest
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.19/index.html">
      1.19
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.18/index.html">
      1.18
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.17/index.html">
      1.17
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.16/index.html">
      1.16
     </a>
    </div>
    <div class="menuitem last">
     <a href="/docs/contributed_modules.html">
      Contributed modules
     </a>
    </div>
   </div>
   <br style="height: 0px; clear: both"/>
  </div>
  <!-- /#headerbar -->
 </nav>
 <div id="content">
 </div>
</header><h1 id="using-holder-of-key-web-browser-sso-profile-on-a-simplesamlphp-sp">
 Using Holder-of-Key Web Browser SSO Profile on a SimpleSAMLphp SP
</h1>
<p>
 This document describes how to enable the
 <a href="http://docs.oasis-open.org/security/saml/Post2.0/sstc-saml-holder-of-key-browser-sso.pdf">
  SAML V2.0 Holder-of-Key (HoK) Web Browser SSO Profile
 </a>
 on a SimpleSAMLphp Service Provider (SP).
</p>
<p>
 The SAML V2.0 HoK Web Browser SSO Profile is an alternate version of the standard SAML Web Browser SSO Profile. Its primary benefit is the enhanced security of the SSO process
while preserving maximum compatibility with existing deployments on client and server side.
</p>
<p>
 When using this profile the communication between the user and the SP is required to be protected by the TLS protocol. Additionally, the user needs a TLS client certificate.
This certificate is usually selfsigned and stored in the certificate store of the browser or the underlying operating system.
</p>
<h2 id="configuring-apache">
 Configuring Apache
</h2>
<p>
 The SP requests a client certificate from the user agent during the TLS handshake. This behaviour is enabled with the following Apache webserver configuration:
</p>
<div class="codehilite">
 <pre><span></span><code>  SSLEngine on
  SSLCertificateFile /etc/openssl/certs/server.crt
  SSLCertificateKeyFile /etc/openssl/private/server.key
  SSLVerifyClient optional_no_ca
  SSLOptions +ExportCertData
</code></pre>
</div>
<p>
 If the user agent can successfully prove possession of the private key associated to the public key from the certificate, the received certificate is stored in the
environment variable
 <code>
  SSL_CLIENT_CERT
 </code>
 of the webserver.
</p>
<h2 id="enable-hok-on-sp">
 Enable HoK on SP
</h2>
<p>
 To enable support for the HoK SSO Profile in the SP, the
 <code>
  saml20.hok.assertion
 </code>
 option must be set to TRUE in the SP configuration.
This option can also be enabled in the
 <code>
  saml20-idp-remote
 </code>
 metadata file, but in that case the endpoint will not be added to the SP metadata.
You must also send authentication requests specifying the Holder-of-Key profile to the IdP. This is controlled by the
 <code>
  ProtocolBinding
 </code>
 option in the SP configuration.
</p>
<div class="codehilite">
 <pre><span></span><code>  'hok-sp' =&gt; array(
      'saml:SP',
      'saml20.hok.assertion' =&gt; TRUE,
      'ProtocolBinding' =&gt; 'urn:oasis:names:tc:SAML:2.0:profiles:holder-of-key:SSO:browser',
  ),
</code></pre>
</div>
<p>
 When this is done, you can add the metadata of your SP to the IdP and test the authentication.
</p></body>
</html>
