<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleSAMLphp Documentation</title>

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
</head>
<body>
<header>
 <div id="header">
  <div class="right">
   <form action="https://www.google.com/cse" method="get" style="margin-top: 2.5rem; margin-right: 2rem">
    <input name="cx" type="hidden" value="004202914224971217557:8ks4jjstupq"/>
    <input name="siteurl" type="hidden" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq"/>
    <input name="adkw" type="hidden" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4"/>
    <input name="q" placeholder="Search" type="search" value=""/>
   </form>
  </div>
  <div class="v-center logo-header">
   <div id="logo">
    <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
     <span class="simple">
      Simple
     </span>
     <span class="saml">
      SAML
     </span>
     <span class="simple">
      php
     </span>
    </a>
   </div>
  </div>
 </div>
 <!-- Grey header bar below -->
 <nav>
  <div id="headerbar" style="clear: both">
   <p id="breadcrumb">
    <a href="https://simplesamlphp.org">
     Home
    </a>
    Â» Documentation
   </p>
   <div class="mtoolbar">
    <div class="menuitem">
     <a href="/docs/1.19/index.html">
      1.19 (stable)
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.18/index.html">
      1.18
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.17/index.html">
      1.17
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.16/index.html">
      1.16
     </a>
    </div>
    <div class="menuitem first">
     <a href="/docs/devel/index.html">
      devel
     </a>
    </div>
    <div class="menuitem last">
     <a href="/docs/contributed_modules.html">
      Contributed modules
     </a>
    </div>
   </div>
   <br style="height: 0px; clear: both"/>
  </div>
  <!-- /#headerbar -->
 </nav>
 <div id="content">
 </div>
</header><main><h1 id="simplesamlphp-advanced-features">
 SimpleSAMLphp Advanced Features
</h1>
<div class="toc">
 <ul>
  <li>
   <a href="#simplesamlphp-advanced-features">
    SimpleSAMLphp Advanced Features
   </a>
   <ul>
    <li>
     <a href="#simplesamlphp-documentation">
      SimpleSAMLphp documentation
     </a>
    </li>
    <li>
     <a href="#bridging-between-protocols">
      Bridging between protocols
     </a>
     <ul>
      <li>
       <a href="#example-of-bridge-configuration">
        Example of bridge configuration
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a href="#attribute-control">
      Attribute control
     </a>
    </li>
    <li>
     <a href="#automatic-update-of-saml-20-metadata-xml-from-https">
      Automatic update of SAML 2.0 Metadata XML from HTTPS
     </a>
    </li>
    <li>
     <a href="#using-simplesamlphp-on-a-web-server-requiring-the-use-of-a-web-proxy">
      Using simpleSAMLphp on a web server requiring the use of a web proxy
     </a>
    </li>
    <li>
     <a href="#auth-memcookie">
      Auth MemCookie
     </a>
    </li>
    <li>
     <a href="#metadata-signing">
      Metadata signing
     </a>
    </li>
    <li>
     <a href="#session-checking-function">
      Session checking function
     </a>
    </li>
    <li>
     <a href="#support">
      Support
     </a>
    </li>
   </ul>
  </li>
 </ul>
</div>
<h2 id="simplesamlphp-documentation">
 SimpleSAMLphp documentation
</h2>
<p>
 This document is part of the SimpleSAMLphp documentation suite.
</p>
<ul>
 <li>
  <a href="http://simplesamlphp.org/docs">
   List of all SimpleSAMLphp documentation
  </a>
 </li>
</ul>
<p>
 This document assumes that you already have a installation of
SimpleSAMLphp running, configured and working. This is the next
step :)
</p>
<h2 id="bridging-between-protocols">
 Bridging between protocols
</h2>
<p>
 A bridge between two protocols is built using both an IdP and an SP, connected together.
To let a SAML 2.0 SP talk to a SAML 1.1 IdP, you build a SimpleSAMLphp bridge from a SAML 2.0 IdP and a SAML 1.1 SP.
The SAML 2.0 SP talks to the SAML 2.0 IdP, which hands the request over to the SAML 1.1 SP, which forwards it to the SAML 1.1 IdP.
</p>
<p>
 If you have followed the instructions for setting up an SP, and have configured an authentication source, all you need to do is to add that authentication source to the IdP.
</p>
<h3 id="example-of-bridge-configuration">
 Example of bridge configuration
</h3>
<p>
 In
 <code>
  metadata/saml20-idp-hosted.php
 </code>
 :
</p>
<div class="codehilite">
 <pre><span></span><code><span class="x">'auth' =&gt; 'default-sp',</span>
</code></pre>
</div>
<p>
 In
 <code>
  config/authsources.php
 </code>
 :
</p>
<div class="codehilite">
 <pre><span></span><code><span class="x">'default-sp' =&gt; [</span>
<span class="x">    'saml:SP',</span>
<span class="x">],</span>
</code></pre>
</div>
<h2 id="attribute-control">
 Attribute control
</h2>
<p>
 Filtering, mapping, etc can be performed by using existing or create new
 <em>
  Authentication Processing Filters
 </em>
 . For more information, read:
</p>
<ul>
 <li>
  <a href="simplesamlphp-authproc.html">
   Authentication Processing Filters in SimpleSAMLphp
  </a>
 </li>
</ul>
<h2 id="automatic-update-of-saml-20-metadata-xml-from-https">
 Automatic update of SAML 2.0 Metadata XML from HTTPS
</h2>
<p>
 The
 <code>
  metarefresh
 </code>
 module is the preferred method for doing this.
Please see the
 <a href="/docs/contrib_modules/metarefresh/simplesamlphp-automated_metadata.html">
  metarefresh documentation
 </a>
 .
</p>
<h2 id="using-simplesamlphp-on-a-web-server-requiring-the-use-of-a-web-proxy">
 Using simpleSAMLphp on a web server requiring the use of a web proxy
</h2>
<p>
 Some modules in simpleSAMLphp may require fetching HTTP/HTTPS content from external websites (e.g. the metarefresh module needs to fetch the metadata from an external source).
</p>
<p>
 simpleSAMLphp can be configured to send HTTP/S requests via such a proxy. The proxy can be configured in the config/config.php option "proxy". Should the proxy require authentication, this can be configured with "proxy.auth".
</p>
<p>
 The default is not to use a proxy ('proxy' = null) and no username and password are used ('proxy.auth' = false).
</p>
<h2 id="auth-memcookie">
 Auth MemCookie
</h2>
<p>
 <a href="http://authmemcookie.sourceforge.net/">
  Auth MemCookie
 </a>
 support is deprecated in the standard code base of SimpleSAMLphp
 and will no longer be available starting in SimpleSAMLphp 2.0. Please use the new
 <a href="https://github.com/simplesamlphp/simplesamlphp-module-memcookie">
  memcookie module
 </a>
 instead.
</p>
<h2 id="metadata-signing">
 Metadata signing
</h2>
<p>
 SimpleSAMLphp supports signing of the metadata it generates. Metadata signing is configured by four options:
</p>
<ul>
 <li>
  <code>
   metadata.sign.enable
  </code>
  : Whether metadata signing should be enabled or not. Set to
  <code>
   TRUE
  </code>
  to enable metadata signing. Defaults to
  <code>
   FALSE
  </code>
  .
 </li>
 <li>
  <code>
   metadata.sign.privatekey
  </code>
  : Location of the private key data which should be used to sign the metadata.
 </li>
 <li>
  <code>
   metadata.sign.privatekey_pass
  </code>
  : Passphrase which should be used to open the private key. This parameter is optional, and should be left out if the private key is unencrypted.
 </li>
 <li>
  <code>
   metadata.sign.certificate
  </code>
  : Location of certificate data which matches the private key.
 </li>
 <li>
  <code>
   metadata.sign.algorithm
  </code>
  : The algorithm to use when signing metadata for this entity. Defaults to RSA-SHA256. Possible values:
  <ul>
   <li>
    <code>
     http://www.w3.org/2000/09/xmldsig#rsa-sha1
    </code>
    <em>
     Note
    </em>
    : the use of SHA1 is
    <strong>
     deprecated
    </strong>
    and will be disallowed in the future.
   </li>
   <li>
    <code>
     http://www.w3.org/2001/04/xmldsig-more#rsa-sha256
    </code>
    The default.
   </li>
   <li>
    <code>
     http://www.w3.org/2001/04/xmldsig-more#rsa-sha384
    </code>
   </li>
   <li>
    <code>
     http://www.w3.org/2001/04/xmldsig-more#rsa-sha512
    </code>
   </li>
  </ul>
 </li>
</ul>
<p>
 These options can be configured globally in the
 <code>
  config/config.php
 </code>
 -file, or per SP/IdP by adding them to the hosted metadata for the SP/IdP. The configuration in the metadata for the SP/IdP takes precedence over the global configuration.
</p>
<p>
 There is also an additional fallback for the private key and the certificate. If
 <code>
  metadata.sign.privatekey
 </code>
 and
 <code>
  metadata.sign.certificate
 </code>
 isn't configured, SimpleSAMLphp will use the
 <code>
  privatekey
 </code>
 ,
 <code>
  privatekey_pass
 </code>
 and
 <code>
  certificate
 </code>
 options in the metadata for the SP/IdP.
</p>
<h2 id="session-checking-function">
 Session checking function
</h2>
<p>
 Optional session checking function, called on session init and loading, defined with 'session.check_function' in config.php.
</p>
<p>
 Example code for the function with GeoIP country check:
</p>
<div class="codehilite">
 <pre><span></span><code><span class="x">public static function checkSession($session, $init = false)</span>
<span class="x">{</span>
<span class="x">    $data_type = 'example:check_session';</span>
<span class="x">    $data_key = 'remote_addr';</span>

<span class="x">    $remote_addr = null;</span>
<span class="x">    if (!empty($_SERVER['REMOTE_ADDR'])) {</span>
<span class="x">        $remote_addr = (string)$_SERVER['REMOTE_ADDR'];</span>
<span class="x">    }</span>

<span class="x">    if ($init) {</span>
<span class="x">        $session-&gt;setData(</span>
<span class="x">            $data_type,</span>
<span class="x">            $data_key,</span>
<span class="x">            $remote_addr,</span>
<span class="x">            \SimpleSAML\Session::DATA_TIMEOUT_SESSION_END</span>
<span class="x">        );</span>
<span class="x">        return;</span>
<span class="x">    }</span>

<span class="x">    if (!function_exists('geoip_country_code_by_name')) {</span>
<span class="x">        \SimpleSAML\Logger::warning('geoip php module required.');</span>
<span class="x">        return true;</span>
<span class="x">    }</span>

<span class="x">    $stored_remote_addr = $session-&gt;getData($data_type, $data_key);</span>
<span class="x">    if ($stored_remote_addr === null) {</span>
<span class="x">        \SimpleSAML\Logger::warning('Stored data not found.');</span>
<span class="x">        return false;</span>
<span class="x">    }</span>

<span class="x">    $country_a = geoip_country_code_by_name($remote_addr);</span>
<span class="x">    $country_b = geoip_country_code_by_name($stored_remote_addr);</span>

<span class="x">    if ($country_a === $country_b) {</span>
<span class="x">        if ($stored_remote_addr !== $remote_addr) {</span>
<span class="x">            $session-&gt;setData(</span>
<span class="x">                $data_type,</span>
<span class="x">                $data_key,</span>
<span class="x">                $remote_addr,</span>
<span class="x">                \SimpleSAML\Session::DATA_TIMEOUT_SESSION_END</span>
<span class="x">            );</span>
<span class="x">        }</span>

<span class="x">        return true;</span>
<span class="x">    }</span>

<span class="x">    return false;</span>
<span class="x">}</span>
</code></pre>
</div>
<h2 id="support">
 Support
</h2>
<p>
 If you need help to make this work, or want to discuss
SimpleSAMLphp with other users of the software, you are fortunate:
Around SimpleSAMLphp there is a great Open source community, and
you are welcome to join! The forums are open for you to ask
questions, contribute answers other further questions, request
improvements or contribute with code or plugins of your own.
</p>
<ul>
 <li>
  <a href="https://simplesamlphp.org">
   SimpleSAMLphp homepage
  </a>
 </li>
 <li>
  <a href="https://simplesamlphp.org/docs/">
   List of all available SimpleSAMLphp documentation
  </a>
 </li>
 <li>
  <a href="https://simplesamlphp.org/lists">
   Join the SimpleSAMLphp user's mailing list
  </a>
 </li>
</ul></main></body>
</html>
