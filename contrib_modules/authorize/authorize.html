<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleSAMLphp Documentation</title>

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
</head>
<body>
<header>
 <div id="header">
  <div class="right">
   <form action="https://www.google.com/cse" method="get" style="margin-top: 2.5rem; margin-right: 2rem">
    <input name="cx" type="hidden" value="004202914224971217557:8ks4jjstupq"/>
    <input name="siteurl" type="hidden" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq"/>
    <input name="adkw" type="hidden" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4"/>
    <input name="q" placeholder="Search" type="search" value=""/>
   </form>
  </div>
  <div class="v-center logo-header">
   <div id="logo">
    <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
     <span class="simple">
      Simple
     </span>
     <span class="saml">
      SAML
     </span>
     <span class="simple">
      php
     </span>
    </a>
   </div>
  </div>
 </div>
 <!-- Grey header bar below -->
 <nav>
  <div id="headerbar" style="clear: both">
   <p id="breadcrumb">
    <a href="https://simplesamlphp.org">
     Home
    </a>
    Â» Documentation
   </p>
   <div class="mtoolbar">
    <div class="menuitem">
     <a href="/docs/2.0/index.html">
      2.0 (stable)
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.19/index.html">
      1.19
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.18/index.html">
      1.18
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.17/index.html">
      1.17
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.16/index.html">
      1.16
     </a>
    </div>
    <div class="menuitem first">
     <a href="/docs/devel/index.html">
      devel
     </a>
    </div>
    <div class="menuitem last">
     <a href="/docs/contributed_modules.html">
      Contributed modules
     </a>
    </div>
   </div>
   <br style="height: 0px; clear: both"/>
  </div>
  <!-- /#headerbar -->
 </nav>
 <div id="content">
 </div>
</header><main><h1 id="authorize-module">
 authorize Module
</h1>
<ul>
 <li>
  Author: Ernesto Revilla
  <a href="mailto/erny@yaco.es.html">
   erny@yaco.es
  </a>
  , Yaco Sistemas, Ryan Panning
 </li>
 <li>
  Package: SimpleSAMLphp
 </li>
</ul>
<p>
 This module provides a user authorization filter based on attribute matching
for those applications that do not cleanly separate authentication from
authorization and set some default permissions for authenticated users.
</p>
<dl>
 <dt>
  <code>
   authorize:Authorize
  </code>
 </dt>
 <dd>
  Authorize certain users based on attribute matching
 </dd>
</dl>
<h2 id="authorizeauthorize">
 <code>
  authorize:Authorize
 </code>
</h2>
<p>
 There are three configuration options that can be defined:
 <code>
  deny
 </code>
 ,
 <code>
  regex
 </code>
 ,
and
 <code>
  reject_msg
 </code>
 . All other filter configuration options are considered
attribute matching rules.
</p>
<p>
 Unauthorized users will be shown a 403 Forbidden page.
</p>
<h3 id="deny">
 <code>
  deny
 </code>
</h3>
<p>
 The default action of the filter is to authorize only if an attribute match
is found (default allow). When set to TRUE, this option reverses that rule and
authorizes the user unless an attribute match is found (default deny), causing
an unauthorized action.
</p>
<p>
 <strong>
  Note
 </strong>
 : This option needs to be boolean (TRUE/FALSE) else it will be considered
          an attribute matching rule.
</p>
<h3 id="regex">
 <code>
  regex
 </code>
</h3>
<p>
 Turn regex pattern matching on or off for the attribute values defined. For
backwards compatibility, this option defaults to TRUE, but can be turned off
by setting it to FALSE.
</p>
<p>
 <strong>
  Note
 </strong>
 : This option needs to be boolean (TRUE/FALSE) else it will be
          considered an attribute matching rule.
</p>
<h3 id="reject_msg">
 <code>
  reject_msg
 </code>
</h3>
<p>
 This option can be used to provide a localised, custom message to an
unauthorised user. For example: tailored instructions on how to fix the
authorisation issue, specific contact details, etc.
</p>
<p>
 It should be an array of key/value pairs, with the keys as the language code.
You can use HTML in the message. See below for an example.
</p>
<h2 id="attribute-rules">
 Attribute Rules
</h2>
<p>
 Each additional filter configuration option is considered an attribute matching
rule. For each attribute, you can specify a string or array of strings to match.
If one of those attributes match one of the rules (OR operator), the user is
authorized/unauthorized (depending on the deny config option).
</p>
<p>
 <strong>
  Note
 </strong>
 : If regex is enabled, you must use the preg_match format, i.e. you have
          to enclose it with a delimiter that does not appear inside the regex
          (e.g. slash (/), at sign (@), number sign (#) or underscore (
 <code>
  _
 </code>
 )).
</p>
<h3 id="problems">
 Problems
</h3>
<ul>
 <li>
  Once you get the forbidden page, you can't logout at the IdP directly,
  (as far as I know), you have to close the browser.
 </li>
</ul>
<h3 id="examples">
 Examples
</h3>
<p>
 To use this filter configure it in
 <code>
  config/config.php
 </code>
 .
For unstructured attributes use
 <code>
  ^
 </code>
 and
 <code>
  $
 </code>
 to anchor your regex as necessary:
</p>
<div class="codehilite">
 <pre><span></span><code><span class="x">'authproc.sp' =&gt; [</span>
<span class="x">    60 =&gt; [</span>
<span class="x">        'class' =&gt; 'authorize:Authorize',</span>
<span class="x">        'uid'   =&gt;  [</span>
<span class="x">            '/^.*@example.com$/',</span>
<span class="x">            /*</span>
<span class="x">             * Use anchors to prevent matching</span>
<span class="x">             * 'wronguser1@example.edu.attacker.com'</span>
<span class="x">             */</span>
<span class="x">            '/^(user1|user2|user3)@example.edu$/',</span>
<span class="x">        ],</span>
<span class="x">        'schacUserStatus' =&gt; '@urn:mace:terena.org:userStatus:' .</span>
<span class="x">        'example.org:service:active.*@',</span>
<span class="x">    ]</span>
<span class="x">]</span>
</code></pre>
</div>
<p>
 An alternate way of using this filter is to deny certain users. Or even use
multiple filters to create a simple ACL, by first allowing a group of users but
then denying a "black list" of users.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="x">'authproc.sp' =&gt; [</span>
<span class="x">    60 =&gt; array[</span>
<span class="x">        'class' =&gt; 'authorize:Authorize',</span>
<span class="x">        'deny'  =&gt; true,</span>
<span class="x">        'uid'   =&gt;  [</span>
<span class="x">            '/.*@students.example.edu$/',</span>
<span class="x">            '/^(stu1|stu2|stu3)@example.edu$/',</span>
<span class="x">        ]</span>
<span class="x">    ]</span>
<span class="x">]</span>
</code></pre>
</div>
<p>
 The regex pattern matching can be turned off, allowing for exact attribute
matching rules. This can be helpful in cases where you know what the value
should be. An example of this is with the memberOf attribute or using the
ldap:AttributeAddUsersGroups filter with the group attribute.
</p>
<p>
 Additionally, some helpful instructions are shown.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="x">'authproc.sp' =&gt; [</span>
<span class="x">    60 =&gt; [</span>
<span class="x">        'class' =&gt; 'authorize:Authorize',</span>
<span class="x">        'regex' =&gt; false,</span>
<span class="x">        'group' =&gt; [</span>
<span class="x">            'CN=SimpleSAML Students,CN=Users,DC=example,DC=edu',</span>
<span class="x">            'CN=All Teachers,OU=Staff,DC=example,DC=edu',</span>
<span class="x">        ],</span>
<span class="x">        'reject_msg' =&gt; [</span>
<span class="x">            'en' =&gt; 'This service is only available to students and' .</span>
<span class="x">                ' teachers. Please contact ' .</span>
<span class="x">                '&lt;a href="mailto:support@example.edu"&gt;support&lt;/a&gt;.',</span>
<span class="x">            'nl' =&gt; 'Deze dienst is alleen beschikbaar voor studenten en ' .</span>
<span class="x">                'docenten. Neem contact op met ' .</span>
<span class="x">                '&lt;a href="mailto:support@example.edu"&gt;support&lt;/a&gt;.',</span>
<span class="x">        ],</span>
<span class="x">    ],</span>
<span class="x">],</span>
</code></pre>
</div></main></body>
</html>
