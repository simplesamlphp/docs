<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleSAMLphp Documentation</title>

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
</head>
<body>
<header>
 <div id="header">
  <div class="right">
   <form action="https://www.google.com/cse" method="get" style="margin-top: 2.5rem; margin-right: 2rem">
    <input name="cx" type="hidden" value="004202914224971217557:8ks4jjstupq"/>
    <input name="siteurl" type="hidden" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq"/>
    <input name="adkw" type="hidden" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4"/>
    <input name="q" placeholder="Search" type="search" value=""/>
   </form>
  </div>
  <div class="v-center logo-header">
   <div id="logo">
    <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
     <span class="simple">
      Simple
     </span>
     <span class="saml">
      SAML
     </span>
     <span class="simple">
      php
     </span>
    </a>
   </div>
  </div>
 </div>
 <!-- Grey header bar below -->
 <nav>
  <div id="headerbar" style="clear: both">
   <p id="breadcrumb">
    <a href="https://simplesamlphp.org">
     Home
    </a>
    Â» Documentation
   </p>
   <div class="mtoolbar">
    <div class="menuitem">
     <a href="/docs/2.3/index.html">
      2.3 (stable)
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/2.2/index.html">
      2.2
     </a>
    </div>
    <div class="menuitem first">
     <a href="/docs/devel/index.html">
      devel
     </a>
    </div>
    <div class="menuitem last">
     <a href="/docs/contributed_modules.html">
      Contributed modules
     </a>
    </div>
   </div>
   <br style="height: 0px; clear: both"/>
  </div>
  <!-- /#headerbar -->
 </nav>
 <div id="content">
 </div>
</header>
<main><h1 id="smartattributes-module">
 SmartAttributes module
</h1>
<p>
 The SmartAttributes module provides authentication processing filters to add attributes.
The logic in this filter exceeds what is possible with the standard filters such, as [
 <code>
  core:AttributeAdd
 </code>
 ], [
 <code>
  core:AttributeAlter
 </code>
 ], and [
 <code>
  core:AttributeMap
 </code>
 ].
</p>
<h2 id="smartattributessmartid">
 <code>
  smartattributes:SmartID
 </code>
</h2>
<p>
 A filter to add an identifier attribute, based on the first non-empty attribute from a given list of attribute names.
This is useful when there are multiple SAML IdPs configured, and there is no common identifier among them.
For example some IdPs send eduPersonPrincipalName, while others send eduPersonTargetedID. If any of the social networks are configured as an authsource, they will send yet another identifier.
The filter has the following configuration options:
</p>
<ul>
 <li>
  <code>
   candidates
  </code>
  . An array of attributes names to consider as the identifier attribute. Defaults to:
  <ul>
   <li>
    eduPersonTargetedID
   </li>
   <li>
    eduPersonPrincipalName
   </li>
   <li>
    pairwise-id
   </li>
   <li>
    subject-id
   </li>
   <li>
    openid
   </li>
   <li>
    facebook_targetedID
   </li>
   <li>
    twitter_targetedID
   </li>
   <li>
    windowslive_targetedID
   </li>
   <li>
    linkedin_targetedID
   </li>
  </ul>
 </li>
 <li>
  <code>
   id_attribute
  </code>
  . A string to use as the name of the newly added attribute. Defaults to
  <code>
   smart_id
  </code>
  .
 </li>
 <li>
  <code>
   add_authority
  </code>
  . A boolean to indicate whether or not to append the SAML AuthenticatingAuthority to the resulting identifier. This can be useful to indicate what SAML IdP was used, in case the original identifier is not scoped. When multiple values are in the AuthenticatingAuthority element, the last (closest to us) will be used. Defaults to
  <code>
   TRUE
  </code>
  .
 </li>
 <li>
  <code>
   add_candidate
  </code>
  . A boolean to indicate whether or not to prepend the candidate attribute name to the resulting identifier. This can be useful to indicate the attribute originating the identifier. Defaults to
  <code>
   TRUE
  </code>
  .
 </li>
 <li>
  <code>
   fail_if_empty
  </code>
  . A boolean to indicate whether this module reports a failure if no suitable identifier attribute could be found. Set this to
  <code>
   FALSE
  </code>
  if a missing identifier attribute should be handled at a later step in the AuthProc filter queue. Defaults to
  <code>
   TRUE
  </code>
  .
 </li>
</ul>
<p>
 The generated identifiers have the following form:
</p>
<p>
 <code>
  AttributeName:AttributeValue!AuthenticatingAuthority
 </code>
</p>
<p>
 For example:
</p>
<p>
 <code>
  eduPersonTargetedID:c4bcbe7ca8eac074f65291fd5524caa88f3115c8!https://login.terena.org/idp/saml2/idp/metadata.php
 </code>
</p>
<h2 id="examples">
 Examples
</h2>
<p>
 Without any configuration:
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">'authproc' =&gt; [</span>
<span class="x">    50 =&gt; [</span>
<span class="x">        'class' =&gt; 'smartattributes:SmartID'</span>
<span class="x">    ],</span>
<span class="x">],</span>
</code></pre>
</div>
<p>
 This will add an attribute called
 <code>
  smart_id
 </code>
 with a value looking like, for example:
</p>
<p>
 <code>
  eduPersonTargetedID:c4bcbe7ca8eac074f65291fd5524caa88f3115c8!https://login.terena.org/idp/saml2/idp/metadata.php
 </code>
</p>
<p>
 Custom configuration:
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">'authproc' =&gt; [</span>
<span class="x">    50 =&gt; [</span>
<span class="x">        'class' =&gt; 'smartattributes:SmartID',</span>
<span class="x">        'candidates' =&gt; ['eduPersonTargetedID', 'eduPersonPrincipalName'],</span>
<span class="x">        'id_attribute' =&gt; 'FooUniversityLocalID',</span>
<span class="x">        'add_authority' =&gt; FALSE,</span>
<span class="x">    ],</span>
<span class="x">],</span>
</code></pre>
</div>
<p>
 This will add an attribute called
 <code>
  FooUniversityLocalID
 </code>
 with a value like:
</p>
<p>
 <code>
  eduPersonTargetedID:c4bcbe7ca8eac074f65291fd5524caa88f3115c8
 </code>
</p>
<p>
 If you also want to remove the name of the originating attribute, you could configure it like this:
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">'authproc' =&gt; [</span>
<span class="x">    50 =&gt; [</span>
<span class="x">        'class' =&gt; 'smartattributes:SmartID',</span>
<span class="x">        'candidates' =&gt; ['eduPersonTargetedID', 'eduPersonPrincipalName'],</span>
<span class="x">        'id_attribute' =&gt; 'FooUniversityLocalID',</span>
<span class="x">        'add_authority' =&gt; FALSE,</span>
<span class="x">        'add_candidate' =&gt; FALSE,</span>
<span class="x">    ],</span>
<span class="x">],</span>
</code></pre>
</div>
<p>
 Resulting in:
</p>
<p>
 <code>
  c4bcbe7ca8eac074f65291fd5524caa88f3115c8
 </code>
</p>
</main></body>
</html>
