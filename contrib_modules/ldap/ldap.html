<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleSAMLphp Documentation</title>

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
</head>
<body>
<header>
 <div id="header">
  <div class="right">
   <form action="https://www.google.com/cse" method="get" style="margin-top: 2.5rem; margin-right: 2rem">
    <input name="cx" type="hidden" value="004202914224971217557:8ks4jjstupq"/>
    <input name="siteurl" type="hidden" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq"/>
    <input name="adkw" type="hidden" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4"/>
    <input name="q" placeholder="Search" type="search" value=""/>
   </form>
  </div>
  <div class="v-center logo-header">
   <div id="logo">
    <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
     <span class="simple">
      Simple
     </span>
     <span class="saml">
      SAML
     </span>
     <span class="simple">
      php
     </span>
    </a>
   </div>
  </div>
 </div>
 <!-- Grey header bar below -->
 <nav>
  <div id="headerbar" style="clear: both">
   <p id="breadcrumb">
    <a href="https://simplesamlphp.org">
     Home
    </a>
    Â» Documentation
   </p>
   <div class="mtoolbar">
    <div class="menuitem">
     <a href="/docs/2.1/index.html">
      2.1 (stable)
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/2.0/index.html">
      2.0
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.19/index.html">
      1.19
     </a>
    </div>
    <div class="menuitem first">
     <a href="/docs/devel/index.html">
      devel
     </a>
    </div>
    <div class="menuitem last">
     <a href="/docs/contributed_modules.html">
      Contributed modules
     </a>
    </div>
   </div>
   <br style="height: 0px; clear: both"/>
  </div>
  <!-- /#headerbar -->
 </nav>
 <div id="content">
 </div>
</header>
<main><h1 id="ldap-module">
 LDAP module
</h1>
<p>
 The LDAP module provides a method for authenticating users against an
LDAP server. There are two separate authentication modules and two
authentication processing filters:
</p>
<dl>
 <dt>
  <code>
   ldap:Ldap
  </code>
 </dt>
 <dd>
  Authenticate the user against a single LDAP server.
 </dd>
 <dt>
  <code>
   ldap:LdapMulti
  </code>
 </dt>
 <dd>
  Allow the user to chose one LDAP server to authenticate against.
 </dd>
 <dt>
  <code>
   ldap:AttributeAddFromLDAP
  </code>
 </dt>
 <dd>
  Adds an attribute value from LDAP to the request
 </dd>
 <dt>
  <code>
   ldap:AttributeAddUsersGroups
  </code>
 </dt>
 <dd>
  Add an attribute to the request with all the user's group memberships
 </dd>
</dl>
<h2 id="ldapldap">
 <code>
  ldap:Ldap
 </code>
</h2>
<p>
 This module is used when you have an organization with a single LDAP
server with all the users. To create an LDAP authentication source, open
 <code>
  config/authsources.php
 </code>
 in a text editor, and add an entry for the
authentication source:
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    'example-ldap' =&gt; [</span>
<span class="x">        'ldap:Ldap',</span>

<span class="x">        /**</span>
<span class="x">         * The connection string for the LDAP-server.</span>
<span class="x">         * You can add multiple by separating them with a space.</span>
<span class="x">         */</span>
<span class="x">        'connection_string' =&gt; 'ldap.example.org',</span>

<span class="x">        /**</span>
<span class="x">         * Whether SSL/TLS should be used when contacting the LDAP server.</span>
<span class="x">         * Possible values are 'ssl', 'tls' or 'none'</span>
<span class="x">         */</span>
<span class="x">        'encryption' =&gt; 'ssl',</span>

<span class="x">        /**</span>
<span class="x">         * The LDAP version to use when interfacing the LDAP-server.</span>
<span class="x">         * Defaults to 3</span>
<span class="x">         */</span>
<span class="x">        'version' =&gt; 3,</span>

<span class="x">        /**</span>
<span class="x">         * Set to TRUE to enable LDAP debug level. Passed to the LDAP connector class.</span>
<span class="x">         *</span>
<span class="x">         * Default: FALSE</span>
<span class="x">         * Required: No</span>
<span class="x">         */</span>
<span class="x">        'debug' =&gt; false,</span>

<span class="x">        /**</span>
<span class="x">         * The LDAP-options to pass when setting up a connection</span>
<span class="x">         * See [Symfony documentation]</span>
<span class="x">         */</span>
<span class="x">        'options' =&gt; [</span>
<span class="x">            /**</span>
<span class="x">             * Set whether to follow referrals.</span>
<span class="x">             * AD Controllers may require 0x00 to function.</span>
<span class="x">             * Possible values are 0x00 (NEVER), 0x01 (SEARCHING),</span>
<span class="x">             *   0x02 (FINDING) or 0x03 (ALWAYS).</span>
<span class="x">             */</span>
<span class="x">            'referrals' =&gt; 0x00,</span>

<span class="x">            'network_timeout' =&gt; 3,</span>
<span class="x">        ],</span>

<span class="x">        /**</span>
<span class="x">         * The connector to use.</span>
<span class="x">         * Defaults to '\SimpleSAML\Module\ldap\Connector\Ldap', but can be set</span>
<span class="x">         * to '\SimpleSAML\Module\ldap\Connector\ActiveDirectory' when</span>
<span class="x">         * authenticating against Microsoft Active Directory. This will</span>
<span class="x">         * provide you with more specific error messages.</span>
<span class="x">         */</span>
<span class="x">        'connector' =&gt; '\SimpleSAML\Module\ldap\Connector\Ldap',</span>

<span class="x">        /**</span>
<span class="x">         * Which attributes should be retrieved from the LDAP server.</span>
<span class="x">         * This can be an array of attribute names, or NULL, in which case</span>
<span class="x">         * all attributes are fetched.</span>
<span class="x">         */</span>
<span class="x">        'attributes' =&gt; null,</span>

<span class="x">        /**</span>
<span class="x">         * Which attributes should be base64 encoded after retrieval from</span>
<span class="x">         * the LDAP server.</span>
<span class="x">         */</span>
<span class="x">        'attributes.binary' =&gt; [</span>
<span class="x">            'jpegPhoto',</span>
<span class="x">            'objectGUID',</span>
<span class="x">            'objectSid',</span>
<span class="x">            'mS-DS-ConsistencyGuid'</span>
<span class="x">        ],</span>

<span class="x">        /**</span>
<span class="x">         * The pattern which should be used to create the user's DN given</span>
<span class="x">         * the username. %username% in this pattern will be replaced with</span>
<span class="x">         * the user's username.</span>
<span class="x">         *</span>
<span class="x">         * This option is not used if the search.enable option is set to TRUE.</span>
<span class="x">         */</span>
<span class="x">        'dnpattern' =&gt; 'uid=%username%,ou=people,dc=example,dc=org',</span>

<span class="x">        /**</span>
<span class="x">         * As an alternative to specifying a pattern for the users DN, it is</span>
<span class="x">         * possible to search for the username in a set of attributes. This is</span>
<span class="x">         * enabled by this option.</span>
<span class="x">         */</span>
<span class="x">        'search.enable' =&gt; false,</span>

<span class="x">        /**</span>
<span class="x">         * An array on DNs which will be used as a base for the search. In</span>
<span class="x">         * case of multiple strings, they will be searched in the order given.</span>
<span class="x">         */</span>
<span class="x">        'search.base' =&gt; [</span>
<span class="x">            'ou=people,dc=example,dc=org',</span>
<span class="x">        ],</span>

<span class="x">        /**</span>
<span class="x">         * The scope of the search. Valid values are 'sub' and 'one' and</span>
<span class="x">         * 'base', first one being the default if no value is set.</span>
<span class="x">         */</span>
<span class="x">        'search.scope' =&gt; 'sub',</span>

<span class="x">        /**</span>
<span class="x">         * The attribute(s) the username should match against.</span>
<span class="x">         *</span>
<span class="x">         * This is an array with one or more attribute names. Any of the</span>
<span class="x">         * attributes in the array may match the value the username.</span>
<span class="x">         */</span>
<span class="x">        'search.attributes' =&gt; ['uid', 'mail'],</span>

<span class="x">        /**</span>
<span class="x">         * Additional filters that must match for the entire LDAP search to</span>
<span class="x">         * be true.</span>
<span class="x">         *</span>
<span class="x">         * This should be a single string conforming to [RFC 1960]</span>
<span class="x">         * and [RFC 2544]. The string is appended to the search attributes</span>
<span class="x">         */</span>
<span class="x">        'search.filter' =&gt; '(&amp;(objectClass=Person)(|(sn=Doe)(cn=John *)))',</span>

<span class="x">        /**</span>
<span class="x">         * The username &amp; password where SimpleSAMLphp should bind to before</span>
<span class="x">         * searching. If this is left NULL, no bind will be performed before</span>
<span class="x">         * searching.</span>
<span class="x">         */</span>
<span class="x">        'search.username' =&gt; null,</span>
<span class="x">        'search.password' =&gt; null,</span>
<span class="x">    ],</span>
</code></pre>
</div>
<p>
 See:
</p>
<ul>
 <li>
  <a href="https://github.com/symfony/symfony/blob/5.4/src/Symfony/Component/Ldap/Adapter/ExtLdap/ConnectionOptions.php">
   Symfony documentation
  </a>
 </li>
 <li>
  <a href="https://datatracker.ietf.org/doc/html/rfc1960">
   RFC 1960
  </a>
 </li>
 <li>
  <a href="https://datatracker.ietf.org/doc/html/rfc2544">
   RFC 2544
  </a>
 </li>
</ul>
<p>
 You should update the name of this authentication source
(
 <code>
  example-ldap
 </code>
 ) to have a name which makes sense to your organization.
You also need to update the
 <code>
  hostname
 </code>
 and
 <code>
  dnpattern
 </code>
 options. The
 <code>
  hostname
 </code>
 should be the hostname of your LDAP server, and the
 <code>
  dnpattern
 </code>
 should be a pattern which can be used to generate the
 <code>
  dn
 </code>
 of a user with a given username.
</p>
<p>
 All other options have default values, and are not required.
</p>
<h2 id="searching-for-a-user">
 Searching for a user
</h2>
<p>
 Sometimes you cannot generate the user's
 <code>
  dn
 </code>
 from the username, or you
may want to allow the user to authenticate with for example their email
address as the username. In this case, you can configure the LDAP
module to search for the users
 <code>
  dn
 </code>
 by searching for the username in
one or more attributes.
</p>
<p>
 To enable searching, you must set the
 <code>
  search.enable
 </code>
 option to
 <code>
  TRUE
 </code>
 .
You must then configure the
 <code>
  search.base
 </code>
 and the
 <code>
  search.attributes
 </code>
 options. The
 <code>
  search.base
 </code>
 -option must be the
 <code>
  dn
 </code>
 which should be used
as the base/root of the search. The
 <code>
  search.attributes
 </code>
 -option is an
array with attributes the username should be matched against.
</p>
<p>
 You can also append the
 <code>
  search.filter
 </code>
 option to further limit your search.
The
 <code>
  search.filter
 </code>
 field is optional and need not be included in your
configuration file.
</p>
<p>
 The
 <code>
  dnpattern
 </code>
 option will not be used if searching is enabled.
</p>
<p>
 Some LDAP servers may require authentication before a search can be
performed. In this case, you should configure the
 <code>
  search.username
 </code>
 and
 <code>
  search.password
 </code>
 options. The
 <code>
  search.username
 </code>
 option is a
 <code>
  dn
 </code>
 which can be used to perform a search, and the
 <code>
  search.password
 </code>
 option
is the password for that
 <code>
  dn
 </code>
 .
</p>
<h2 id="configuring-failover">
 Configuring failover
</h2>
<p>
 You can configure multiple LDAP servers in the hostname option by separating
the individual hosts with a space. This enables the builtin LDAP failover
in OpenLDAP.
</p>
<p>
 Note that OpenLDAP waits for a timeout from the first server before attempting
to connect to the other. To avoid a very long wait, it is recommended to change
the timeouts. This can be done in the system-wide ldap configuration file.
</p>
<p>
 NETWORK_TIMEOUT 10
TIMELIMIT       15
TIMEOUT         20
</p>
<p>
 In this case, if we are unable to connect to the first LDAP server within
10 seconds, we will attempt the next.
(Note: the NETWORK_TIMEOUT option was introduced with OpenLDAP version 2.4.)
</p>
<p>
 Example:
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    /* Configuration that uses two ldap servers. */</span>
<span class="x">    'example-ldap' =&gt; [</span>
<span class="x">        'ldap:Ldap',</span>
<span class="x">        /* The hostname of the LDAP server. */</span>
<span class="x">        'connect_string' =&gt; 'ldaps://ldap1.example.org ldaps://ldap2.example.org',</span>
<span class="x">        'dnpattern' =&gt; 'uid=%username%,ou=people,dc=example,dc=org',</span>
<span class="x">    ],</span>
</code></pre>
</div>
<h3 id="ldapldapmulti">
 <code>
  ldap:LdapMulti
 </code>
</h3>
<p>
 This module can be used if your organization has separate groups with
separate LDAP servers or separate LDAP configurations. To use this
authentication module, open
 <code>
  config/authsources.php
 </code>
 in a text editor,
and add an entry which uses this module:
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    'example-ldapmulti' =&gt; [</span>
<span class="x">        'ldap:LdapMulti',</span>

<span class="x">        /*</span>
<span class="x">         * The way the organization as part of the username should be handled.</span>
<span class="x">         * Three possible values:</span>
<span class="x">         * - 'none':   No handling of the organization. Allows '@' to be part</span>
<span class="x">         *             of the username.</span>
<span class="x">         * - 'allow':  Will allow users to type 'username@organization'.</span>
<span class="x">         * - 'force':  Force users to type 'username@organization'. The dropdown</span>
<span class="x">         *             list will be hidden.</span>
<span class="x">         *</span>
<span class="x">         * The default is 'none'.</span>
<span class="x">         */</span>
<span class="x">        'username_organization_method' =&gt; 'none',</span>

<span class="x">        /*</span>
<span class="x">         * Whether the organization should be included as part of the username</span>
<span class="x">         * when authenticating. If this is set to TRUE, the username will be on</span>
<span class="x">         * the form &lt;username&gt;@&lt;organization identifier&gt;. If this is FALSE, the</span>
<span class="x">         * username will be used as the user enters it.</span>
<span class="x">         *</span>
<span class="x">         * The default is FALSE.</span>
<span class="x">         */</span>
<span class="x">        'include_organization_in_username' =&gt; false,</span>

<span class="x">        /*</span>
<span class="x">         * A list of available LDAP servers.</span>
<span class="x">         *</span>
<span class="x">         * The index is an identifier for the organization/group. When</span>
<span class="x">         * 'username_organization_method' is set to something other than 'none',</span>
<span class="x">         * the organization-part of the username is matched against the index.</span>
<span class="x">         *</span>
<span class="x">         * The value of each element is an array in the same format as an LDAP</span>
<span class="x">         * authentication source.</span>
<span class="x">         */</span>
<span class="x">        'mapping' =&gt; [</span>
<span class="x">            'employees' =&gt; [</span>
<span class="x">                /**</span>
<span class="x">                 * A short name/description for this group. Will be shown in a</span>
<span class="x">                 * dropdown list when the user logs on.</span>
<span class="x">                 *</span>
<span class="x">                 * This option can be a string or an array with</span>
<span class="x">                 * language =&gt; text mappings.</span>
<span class="x">                 */</span>
<span class="x">                'description' =&gt; 'Employees',</span>
<span class="x">                'authsource' =&gt; ''example-ldap,</span>
<span class="x">            ],</span>

<span class="x">            'students' =&gt; [</span>
<span class="x">                'description' =&gt; 'Students',</span>
<span class="x">                'authsource' =&gt; 'example-ldap-2',</span>
<span class="x">            ],</span>
<span class="x">        ],</span>

<span class="x">    ],</span>
</code></pre>
</div>
<p>
 The name of the authentication source (
 <code>
  example-ldapmulti
 </code>
 ) should be
changed to something that makes sense for your organization. Each entry
in the configuration represents the configuration for one group of
users. The
 <code>
  description
 </code>
 -option in each group is the name of the group,
and will be shown to the user in a dropdown list on the login page.
</p>
<p>
 The
 <code>
  description
 </code>
 -option can also be an array with descriptions in
different languages:
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    'description' =&gt; [</span>
<span class="x">        'en' =&gt; 'Employees',</span>
<span class="x">        'no' =&gt; 'Ansatte',</span>
<span class="x">    ],</span>
</code></pre>
</div>
<p>
 All options from the
 <code>
  ldap:Ldap
 </code>
 configuration can be used in each
group, and you should refer to the documentation for that module for
more information about available options.
</p>
<h3 id="ldapattributeaddfromldap">
 <code>
  ldap:AttributeAddFromLDAP
 </code>
</h3>
<p>
 Filter to add attributes to the identity by executing a query against
an LDAP directory. In addition to all the configuration options available
in the ldap:AttributeAddUsersGroups filter (below), these are the filter
specific configuration options:
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    50 =&gt; [</span>
<span class="x">        'class' =&gt; 'ldap:AttributeAddFromLDAP',</span>

<span class="x">        /**</span>
<span class="x">         * The attributes to search for and their mappings. This must be an array,</span>
<span class="x">         * and keys can be skipped. If you skip a key, then the attribute will be</span>
<span class="x">         * exported with the same name as the LDAP attribute.</span>
<span class="x">         *</span>
<span class="x">         * Default: NULL</span>
<span class="x">         * Required: Yes</span>
<span class="x">         */</span>
<span class="x">        'attributes' =&gt; ['mail', 'jpegPhoto' =&gt; 'jpegphoto'],</span>

<span class="x">        /**</span>
<span class="x">         * The attribute policy that defines what to do with attributes that are</span>
<span class="x">         * already part of the attributes of the user. Can be one of:</span>
<span class="x">         *</span>
<span class="x">         * - add: blindly add the values. If the attribute already exists and has</span>
<span class="x">         * the same value, the result of the filter will be two equal values.</span>
<span class="x">         *</span>
<span class="x">         * - merge: carefully merge the values. If a value is already part of</span>
<span class="x">         * the attribute, do not add a duplicate.</span>
<span class="x">         *</span>
<span class="x">         * - replace: if the attribute is present before running the filter,</span>
<span class="x">         * replace its values with the ones obtained at this point.</span>
<span class="x">         *</span>
<span class="x">         * Default: merge</span>
<span class="x">         * Required: No</span>
<span class="x">         */</span>
<span class="x">        'attribute.policy' =&gt; 'merge',</span>

<span class="x">        /**</span>
<span class="x">         * The search filter to find the user in LDAP.</span>
<span class="x">         *</span>
<span class="x">         * Note: Variable substitution will be performed on this option.</span>
<span class="x">         *       Any attribute in the identity can be substituted by surrounding</span>
<span class="x">         *       it with percent symbols (%). For instance %cn% would be replaced</span>
<span class="x">         *       with the CN of the user.</span>
<span class="x">         *</span>
<span class="x">         * Default: NULL</span>
<span class="x">         * Required: Yes</span>
<span class="x">         */</span>
<span class="x">        'search.filter' =&gt; '(uid=%uid%)',</span>
<span class="x">    ];</span>
</code></pre>
</div>
<h2 id="backwards-compatibility">
 Backwards Compatibility
</h2>
<p>
 Previous versions of this filter allowed just one attribute to be fetched from
the LDAP at a time. The options 'attribute.new' and 'search.attribute' were used
instead of the new option 'attributes'. Fortunately, the filter is backwards
compatible, so your old configuration will still work, but keep in mind that the
old configuration style is deprecated now and will be removed in 2.0.
</p>
<p>
 Example:
</p>
<p>
 This is the most basic configuration possible. It will look at the
authsource for all LDAP connection information and queries LDAP for
the specific attributes requested.
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    50 =&gt; [</span>
<span class="x">        'class' =&gt; 'ldap:AttributeAddFromLDAP',</span>
<span class="x">        'authsource' =&gt; 'example-ldap',</span>
<span class="x">        'attributes' =&gt; ['displayName' =&gt; 'cn', 'jpegPhoto'],</span>
<span class="x">        'search.filter' =&gt; '(uid=%uid%)',</span>
<span class="x">    ]</span>
</code></pre>
</div>
<p>
 If no authsource is available then you can specify the connection info
using the filter configuration. Note: Not all of the options below are
required, see the config options for ldap:AttributeAddFromLDAP above.
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    50 =&gt; [</span>
<span class="x">        'class' =&gt; 'ldap:AttributeAddFromLDAP',</span>
<span class="x">        'connection_string' =&gt; 'ldap.example.org',</span>
<span class="x">        'search.username' =&gt; 'CN=LDAP User,CN=Users,DC=example,DC=org',</span>
<span class="x">        'search.password' =&gt; 'Abc123',</span>
<span class="x">        'search.base' =&gt; ['DC=example,DC=org'],</span>
<span class="x">        'search.filter' =&gt; '(uid=%uid%)',</span>
<span class="x">        'attributes' =&gt; ['displayName' =&gt; 'cn', 'jpegPhoto'],</span>
<span class="x">    ]</span>
</code></pre>
</div>
<h3 id="ldapattributeaddusersgroups">
 <code>
  ldap:AttributeAddUsersGroups
 </code>
</h3>
<p>
 This filter will add the logged in user's LDAP group memberships to
a specified request attribute. Although most LDAP products have a
memberOf attribute which only lists the direct membership relations,
this filter checks those relation for "sub" groups, recursively
checking the hierarchy for all groups the user would technically be
a member of. This can be helpful for other filters to know. Below is
a listing of all configuration options and their details.
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    50 =&gt; [</span>
<span class="x">        'class' =&gt; 'ldap:AttributeAddUsersGroups',</span>


<span class="x">        /**</span>
<span class="x">         * LDAP connection settings can be retrieved from an ldap:LDAP</span>
<span class="x">         * authsource. Specify the authsource name here to pull that</span>
<span class="x">         * data from the authsources.php file in the config folder.</span>
<span class="x">         *</span>
<span class="x">         * Note: ldap:LDAPMulti is not supported as the SimpleSAMLphp</span>
<span class="x">         *       framework does not pass any information about which</span>
<span class="x">         *       LDAP source the user selected.</span>
<span class="x">         *</span>
<span class="x">         * Default: NULL</span>
<span class="x">         * Require: No</span>
<span class="x">         */</span>
<span class="x">        'authsource' =&gt; null,</span>
<span class="x">        'authsource' =&gt; 'example-ldap',</span>


<span class="x">        /**</span>
<span class="x">         * This is the attribute name which the users groups will be</span>
<span class="x">         * added to. If the attribute exists in the request then the</span>
<span class="x">         * filter will attempt to add them.</span>
<span class="x">         *</span>
<span class="x">         * Default: 'groups'</span>
<span class="x">         * Required: No</span>
<span class="x">         */</span>
<span class="x">        'attribute.groups' =&gt; 'groups',</span>


<span class="x">        /**</span>
<span class="x">         * The base DNs used to search LDAP. May not be needed if searching</span>
<span class="x">         * LDAP using the standard method, meaning that no Product is specified.</span>
<span class="x">         *</span>
<span class="x">         * Default: []</span>
<span class="x">         * Required: No</span>
<span class="x">         * AuthSource: search.base</span>
<span class="x">         */</span>
<span class="x">        'search.base' =&gt; [</span>
<span class="x">            'OU=Staff,DC=example,DC=org',</span>
<span class="x">            'OU=Students,DC=example,DC=org'</span>
<span class="x">        ],</span>


<span class="x">        /**</span>
<span class="x">         * Set to TRUE to enable LDAP debug level. Passed to</span>
<span class="x">         * the LDAP connection class.</span>
<span class="x">         *</span>
<span class="x">         * Default: FALSE</span>
<span class="x">         * Required: No</span>
<span class="x">         * AuthSource: debug</span>
<span class="x">         */</span>
<span class="x">        'debug' =&gt; false,</span>
<span class="x">        'debug' =&gt; true,</span>


<span class="x">        /**</span>
<span class="x">         * Whether SSL/TLS should be used when contacting the LDAP server.</span>
<span class="x">         * Possible values are 'ssl', 'tls' or 'none'</span>
<span class="x">         */</span>
<span class="x">        'encryption' =&gt; 'tls',</span>
<span class="x">        'encryption' =&gt; 'ssl',</span>


<span class="x">        /**</span>
<span class="x">         * This is the hostname string of LDAP server(s) to try</span>
<span class="x">         * and connect to. It should be the same format as the</span>
<span class="x">         * LDAP authsource hostname as it is passed to that class.</span>
<span class="x">         *</span>
<span class="x">         * Note: Multiple servers are separated by a space.</span>
<span class="x">         *</span>
<span class="x">         * Default: NULL</span>
<span class="x">         * Required: Yes, unless authsource is used</span>
<span class="x">         * AuthSource: hostname</span>
<span class="x">         */</span>
<span class="x">        'connection_string' =&gt; 'ldap.example.org',</span>
<span class="x">        'connection_string' =&gt; 'ad1.example.org ad2.example.org',</span>


<span class="x">        /**</span>
<span class="x">         * This is the password used to bind to LDAP.</span>
<span class="x">         *</span>
<span class="x">         * Default: NULL</span>
<span class="x">         * Required: No, only if required for binding.</span>
<span class="x">         * AuthSource: search.password OR priv.password</span>
<span class="x">         */</span>
<span class="x">        'search.password' =&gt; 'Abc123',</span>


<span class="x">        /**</span>
<span class="x">         * By specifying the directory service product name, the number</span>
<span class="x">         * of LDAP queries can be drastically reduced. The reason is</span>
<span class="x">         * that most products have a special query to recursively search</span>
<span class="x">         * group membership.</span>
<span class="x">         *</span>
<span class="x">         * Note: Only ActiveDirectory is currently supported </span>
<span class="x">         * (OpenLDAP is implemented but not supported, see example below).</span>
<span class="x">         *</span>
<span class="x">         * Default: ''</span>
<span class="x">         * Required: No</span>
<span class="x">         */</span>
<span class="x">        'ldap.product' =&gt; '',</span>
<span class="x">        'ldap.product' =&gt; 'ActiveDirectory',</span>
<span class="x">        'ldap.product' =&gt; 'OpenLDAP',</span>


<span class="x">        /**</span>
<span class="x">         * The LDAP timeout value passed to the LDAP connection class.</span>
<span class="x">         *</span>
<span class="x">         * Default: 0</span>
<span class="x">         * Required: No</span>
<span class="x">         * AuthSource: timeout</span>
<span class="x">         */</span>
<span class="x">        'timeout' =&gt; 0,</span>
<span class="x">        'timeout' =&gt; 30,</span>


<span class="x">        /**</span>
<span class="x">         * This is the username used to bind to LDAP with.</span>
<span class="x">         * More than likely will need to be in the DN of</span>
<span class="x">         * user binding to LDAP.</span>
<span class="x">         *</span>
<span class="x">         * Default: NULL</span>
<span class="x">         * Required: No, only if required for binding.</span>
<span class="x">         * AuthSource: search.username OR priv.username</span>
<span class="x">         */</span>
<span class="x">        'search.username' =&gt; 'CN=LDAP User,CN=Users,DC=example,DC=org',</span>


<span class="x">        /**</span>
<span class="x">         * The following attribute.* and type.* configuration options</span>
<span class="x">         * define the LDAP schema and should only be defined/modified</span>
<span class="x">         * if the schema has been modified or the LDAP product used</span>
<span class="x">         * uses other attribute names. By default, the schema is setup</span>
<span class="x">         * for ActiveDirectory.</span>
<span class="x">         *</span>
<span class="x">         * Defaults: Listed Below</span>
<span class="x">         * Required: No</span>
<span class="x">         */</span>
<span class="x">        'attribute.dn' =&gt; 'distinguishedName',</span>
<span class="x">        'attribute.groups' =&gt; 'groups', // Also noted above</span>
<span class="x">        'attribute.member' =&gt; 'member',</span>
<span class="x">        'attribute.memberOf' =&gt; 'memberOf',</span>
<span class="x">        'attribute.groupname' =&gt; 'name',</span>
<span class="x">        'attribute.return' =&gt; 'distinguishedName',</span>
<span class="x">        'attribute.type' =&gt; 'objectClass',</span>
<span class="x">        'attribute.username' =&gt; 'sAMAccountName',</span>


<span class="x">        /**</span>
<span class="x">         * As mentioned above, these can be changed if the LDAP schema</span>
<span class="x">         * has been modified. These list the Object/Entry Type for a given</span>
<span class="x">         * DN, in relation to the 'attribute.type' config option above.</span>
<span class="x">         * These are used to determine the type of entry.</span>
<span class="x">         *</span>
<span class="x">         * Defaults: Listed Below</span>
<span class="x">         * Required: No</span>
<span class="x">         */</span>
<span class="x">        'type.group' =&gt; 'group',</span>
<span class="x">        'type.user' =&gt; 'user',</span>


<span class="x">        /**</span>
<span class="x">         * LDAP search filters to be added to the base filters for this</span>
<span class="x">         * authproc-filter. It's an array of key =&gt; value pairs that will</span>
<span class="x">         * be translated to (key=value) in the ldap query.</span>
<span class="x">         */</span>
<span class="x">        'additional_filters' =&gt; [],</span>
<span class="x">    ]</span>
</code></pre>
</div>
<h3 id="example">
 Example
</h3>
<p>
 This is the most basic configuration possible. It will look at the
authsource for all LDAP connection information and manually search
the hierarchy for the users group memberships.
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    50 =&gt; [</span>
<span class="x">        'class' =&gt; 'ldap:AttributeAddUsersGroups',</span>
<span class="x">        'authsource' =&gt; 'example-ldap'</span>
<span class="x">    ]</span>
</code></pre>
</div>
<p>
 By making one small change we can optimize the filter to use better
group search methods and eliminate un-needed LDAP queries.
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    50 =&gt; [</span>
<span class="x">        'class' =&gt; 'ldap:AttributeAddUsersGroups',</span>
<span class="x">        'authsource' =&gt; 'example-ldap',</span>
<span class="x">        'ldap.product' =&gt; 'ActiveDirectory'</span>
<span class="x">    ]</span>
</code></pre>
</div>
<p>
 If no authsource is available then you can specify the connection info
using the filter configuration. Note: Not all of the options below are
required, see the config info above for details.
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    50 =&gt; [</span>
<span class="x">        'class' =&gt; 'ldap:AttributeAddUsersGroups',</span>
<span class="x">        'connection_string' =&gt; 'ldaps://ldap.example.org',</span>
<span class="x">        'search.username' =&gt; 'CN=LDAP User,CN=Users,DC=example,DC=org',</span>
<span class="x">        'search.password' =&gt; 'Abc123',</span>
<span class="x">        'search.base' =&gt; ['DC=example,DC=org'],</span>
<span class="x">    ]</span>
</code></pre>
</div>
<p>
 Example for unsupported OpenLDAP usage.
Intention is to filter in
 <code>
  ou=groups,dc=example,dc=com
 </code>
 for
 <code>
  (memberUid = &lt;UID&gt;)
 </code>
 and take only the attribute
 <code>
  cn
 </code>
 (=name of the group).
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    50 =&gt; [</span>
<span class="x">        'class' =&gt; 'ldap:AttributeAddUsersGroups',</span>
<span class="x">        'ldap.product' =&gt; 'OpenLDAP',</span>
<span class="x">        'search.base' =&gt; ['ou=groups,dc=example,dc=org'],</span>
<span class="x">        'attribute.username' =&gt; 'uid',</span>
<span class="x">        'attribute.member' =&gt; 'cn',</span>
<span class="x">        'attribute.memberOf' =&gt; 'memberUid',</span>
<span class="x">    ],</span>
</code></pre>
</div>
</main></body>
</html>
