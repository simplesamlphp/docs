<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleSAMLphp Documentation</title>

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
</head>
<body>
<header>
 <div id="header">
  <div class="right">
   <form action="https://www.google.com/cse" method="get" style="margin-top: 2.5rem; margin-right: 2rem">
    <input name="cx" type="hidden" value="004202914224971217557:8ks4jjstupq"/>
    <input name="siteurl" type="hidden" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq"/>
    <input name="adkw" type="hidden" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4"/>
    <input name="q" placeholder="Search" type="search" value=""/>
   </form>
  </div>
  <div class="v-center logo-header">
   <div id="logo">
    <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
     <span class="simple">
      Simple
     </span>
     <span class="saml">
      SAML
     </span>
     <span class="simple">
      php
     </span>
    </a>
   </div>
  </div>
 </div>
 <!-- Grey header bar below -->
 <nav>
  <div id="headerbar" style="clear: both">
   <p id="breadcrumb">
    <a href="https://simplesamlphp.org">
     Home
    </a>
    Â» Documentation
   </p>
   <div class="mtoolbar">
    <div class="menuitem">
     <a href="/docs/2.3/index.html">
      2.3 (stable)
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/2.2/index.html">
      2.2
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/2.1/index.html">
      2.1
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/2.0/index.html">
      2.0
     </a>
    </div>
    <div class="menuitem first">
     <a href="/docs/devel/index.html">
      devel
     </a>
    </div>
    <div class="menuitem last">
     <a href="/docs/contributed_modules.html">
      Contributed modules
     </a>
    </div>
   </div>
   <br style="height: 0px; clear: both"/>
  </div>
  <!-- /#headerbar -->
 </nav>
 <div id="content">
 </div>
</header>
<main><h1 id="sqlauthsql">
 <code>
  sqlauth:SQL
 </code>
</h1>
<p>
 These are authentication modules for authenticating a user against a
SQL database.
</p>
<p>
 The SQL module performs password verification in the database itself
using database functions such as sha512 and storing a salt in the
database. The PasswordVerify module verifies passwords in php using
the password_verify() function. The PasswordVerify module was created
to ask the least of the database either because there is minimal
support in the database or to allow the same code to work against many
databases without modification. More information on PasswordVerify is
provided at the end of this document.
</p>
<h2 id="options">
 Options
</h2>
<dl>
 <dt>
  <code>
   dsn
  </code>
 </dt>
 <dd>
  The DSN which should be used to connect to the database server.
  Check the various database drivers in the
  <a href="http://php.net/manual/en/pdo.drivers.php">
   PHP documentation
  </a>
  for a description of the various DSN formats.
 </dd>
 <dt>
  <code>
   username
  </code>
 </dt>
 <dd>
  The username which should be used when connecting to the database server.
 </dd>
 <dt>
  <code>
   password
  </code>
 </dt>
 <dd>
  The password which should be used when connecting to the database server.
 </dd>
 <dt>
  <code>
   query
  </code>
 </dt>
 <dd>
  The SQL query or queries which should be used to authenticate the user and retrieve their attributes.
 </dd>
 <dt>
  <code>
   username_regex
  </code>
 </dt>
 <dd>
  (Optional) A regular expression that the username must match. Useful if the type of the username column in the database isn't a string (eg. an integer), or if the format is well known (eg. email address, single word with no spaces, etc) to avoid going to the database for a query that will never result in successful authentication.
 </dd>
 <dt>
  <code>
   passwordhashcolumn
  </code>
 </dt>
 <dd>
  (Optional) Only When using the sqlauth:PasswordVerify module. This is the name of the column that contains the hashed password. The default is to look for a column 'passwordhash' in the database.
 </dd>
</dl>
<h2 id="writing-a-query-queries">
 Writing a Query / Queries
</h2>
<p>
 A
 <code>
  query
 </code>
 can be either a single string with an SQL statement, or an array of queries, run in order. That single string (or the first query in the array) is the "authentication query" - the parameters
 <code>
  :username
 </code>
 and
 <code>
  :password
 </code>
 are available and should be evaluated by the query for authenticaion purposes. If the username/password is incorrect, the "authentication query" should return no rows. The rows returned represent attributes to be returned.
</p>
<p>
 Taking this example schema:
</p>
<div class="highlight">
 <pre><span></span><code><span class="w">    </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">uid</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">      </span><span class="n">password</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">salt</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">givenName</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">email</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">eduPersonPrincipalName</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">usergroups</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">uid</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span><span class="n">uid</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">      </span><span class="n">groupname</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">groupname</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>
</code></pre>
</div>
<p>
 a basic entry with a single SQL string in
 <code>
  authsources.php
 </code>
 might look like this (PostgreSQL, SHA512 of salt + password, base64 encoded with the salt stored in an independent column):
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    'example-sql' =&gt; [</span>
<span class="x">        'sqlauth:SQL',</span>
<span class="x">        'dsn' =&gt; 'pgsql:host=postgresql;port=5432;dbname=simplesaml',</span>
<span class="x">        'username' =&gt; 'simplesaml',</span>
<span class="x">        'password' =&gt; 'secretpassword',</span>
<span class="x">        'query' =&gt; "select uid, givenName as \"givenName\", email from users where uid=:username and password=encode(sha512(concat((select salt from users where uid=1),  :password)::bytea), 'base64')",</span>
<span class="x">        'username_regex' =&gt; '/^[a-z]+$/', // Username will only be acceptable if it is a single lower case word</span>
<span class="x">    ],</span>
</code></pre>
</div>
<p>
 It's worth repeating at this point that if authentication is unsuccessful (ie. the username / password pair don't match), this query
 <strong>
  must
 </strong>
 return zero rows. Assuming the username / password pair provided was a match, the name of the columns in result set will be used as attribute names. In the above case, PostgreSQL lowercases the names by default, which we correct with the "as" clause. The result might look like this:
</p>
<table>
 <thead>
  <tr>
   <th>
    Attribute Name
   </th>
   <th>
    Attribute Value
   </th>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td>
    uid
   </td>
   <td>
    [ bobsmith ]
   </td>
  </tr>
  <tr>
   <td>
    givenName
   </td>
   <td>
    [ Bob ]
   </td>
  </tr>
  <tr>
   <td>
    email
   </td>
   <td>
    [ bob@example.com ]
   </td>
  </tr>
 </tbody>
</table>
<p>
 You'll likely need to collect attributes from more than just the table with the username and password hash. There are two supported ways to do this: table joins on your authentication query, or providing an array of queries for the
 <code>
  query
 </code>
 parameter instead of just the single query.
</p>
<p>
 A basic example of the single query with join:
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    'example-sql' =&gt; [</span>
<span class="x">        'sqlauth:SQL',</span>
<span class="x">        'dsn' =&gt; 'pgsql:host=postgresql;port=5432;dbname=simplesaml',</span>
<span class="x">        'username' =&gt; 'simplesaml',</span>
<span class="x">        'password' =&gt; 'secretpassword',</span>
<span class="x">        'query' =&gt; "select u.uid, u.givenName as \"givenName\", ug.groupname as \"groupName\" from users u left join usergroups ug on (u.uid=ug.uid) where u.uid=:username and u.password=encode(sha512(concat((select salt from users where uid=1),  :password)::bytea), 'base64')",</span>
<span class="x">    ],</span>
</code></pre>
</div>
<p>
 which can also be written as:
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">    'example-sql' =&gt; [</span>
<span class="x">        'sqlauth:SQL',</span>
<span class="x">        'dsn' =&gt; 'pgsql:host=postgresql;port=5432;dbname=simplesaml',</span>
<span class="x">        'username' =&gt; 'simplesaml',</span>
<span class="x">        'password' =&gt; 'secretpassword',</span>
<span class="x">        'query' =&gt; [</span>
<span class="x">            "select uid, givenName as \"givenName\", email from users where uid=:username and password=encode(sha512(concat((select salt from users where uid=1),  :password)::bytea), 'base64')",</span>
<span class="x">            "select groupName as \"groupName\" from usergroups where uid=:username",</span>
<span class="x">        ],</span>
<span class="x">        "select u.uid, u.givenName, ug.groupname from users u left join usergroups ug on (u.uid=ug.uid) where u.uid=:username and u.password=encode(sha512(concat((select salt from users where uid=1),  :password)::bytea), 'base64')",</span>
<span class="x">    ],</span>
</code></pre>
</div>
<p>
 both of which will return attributes like:
</p>
<table>
 <thead>
  <tr>
   <th>
    Attribute Name
   </th>
   <th>
    Attribute Value
   </th>
  </tr>
 </thead>
 <tbody>
  <tr>
   <td>
    uid
   </td>
   <td>
    [ bobsmith ]
   </td>
  </tr>
  <tr>
   <td>
    givenName
   </td>
   <td>
    [ Bob ]
   </td>
  </tr>
  <tr>
   <td>
    email
   </td>
   <td>
    [ bob@example.com ]
   </td>
  </tr>
  <tr>
   <td>
    groupName
   </td>
   <td>
    [ users, staff ]
   </td>
  </tr>
 </tbody>
</table>
<p>
 For simple cases, the single query will suffice. As the number of tables you are joining to collate your attributes gets higher, then using the query list will make your configuration more maintainable.
</p>
<p>
 In summary:
</p>
<ul>
 <li>
  If the single string query (or the first query if it's an array of queries) returns no rows, that indicates authentication failed.
 </li>
 <li>
  The single string query (or the first query if it's an array of queries) should use the passed
  <code>
   :username
  </code>
  and
  <code>
   :password
  </code>
  query parameters to do authentication.
 </li>
 <li>
  If more than one query is desirable or required to get all of the attributes, you can specify an array of queries. In this case, the result set of the second and subsequent queries in that array provide attributes only - only the first query is used to determine if the username/password is correct or not, and as such :password is only passed to the first query in the list.
 </li>
 <li>
  If
  <code>
   query
  </code>
  is an array of queries, because the second and subsequent queries have no role in authentication, these queries may return no rows, simply indicating that query should have no effect on the final returned attribute set.
 </li>
 <li>
  If any query returns multiple rows, they will be merged into the attributes.
 </li>
 <li>
  If multiple queries return the same column names, they will also be merged into the same attributes.
 </li>
 <li>
  Duplicate values and NULL values will be removed.
 </li>
</ul>
<h2 id="further-examples">
 Further Examples
</h2>
<div class="highlight">
 <pre><span></span><code><span class="n">Example</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">SHA256</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">salt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="k">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">salt</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">independent</span><span class="w"> </span><span class="k">column</span><span class="p">,</span><span class="w"> </span><span class="n">MySQL</span><span class="w"> </span><span class="n">server</span><span class="p">:</span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">givenName</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">eduPersonPrincipalName</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">:</span><span class="n">username</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">PASSWORD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SHA2</span><span class="p">(</span>
<span class="w">        </span><span class="n">CONCAT</span><span class="p">(</span>
<span class="w">            </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">salt</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">:</span><span class="n">username</span><span class="p">),</span>
<span class="w">            </span><span class="p">:</span><span class="n">password</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="mi">256</span>
<span class="w">    </span><span class="p">)</span>
</code></pre>
</div>
<p>
 Example query - SHA256 of salt + password, with the salt stored in an independent column. Multiple groups, MySQL server:
</p>
<div class="highlight">
 <pre><span></span><code><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">givenName</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">eduPersonPrincipalName</span><span class="p">,</span><span class="w"> </span><span class="n">groupname</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">groups</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">usergroups</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">usergroups</span><span class="p">.</span><span class="n">username</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">users</span><span class="p">.</span><span class="n">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">:</span><span class="n">username</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">PASSWORD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SHA2</span><span class="p">(</span>
<span class="w">        </span><span class="n">CONCAT</span><span class="p">(</span>
<span class="w">            </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">salt</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">:</span><span class="n">username</span><span class="p">),</span>
<span class="w">            </span><span class="p">:</span><span class="n">password</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="mi">256</span>
<span class="w">    </span><span class="p">)</span>
</code></pre>
</div>
<p>
 Example query - SHA512 of salt + password, stored as salt (32 bytes) + sha256(salt + password) in password-field, PostgreSQL server:
</p>
<div class="highlight">
 <pre><span></span><code><span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">givenName</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">eduPersonPrincipalName</span>
<span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="n">users</span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">:</span><span class="n">username</span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="k">SUBSTRING</span><span class="p">(</span>
<span class="w">        </span><span class="n">password</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">31</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SHA2</span><span class="p">(</span>
<span class="w">        </span><span class="n">CONCAT</span><span class="p">(</span>
<span class="w">            </span><span class="k">SUBSTRING</span><span class="p">(</span><span class="n">password</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="k">LENGTH</span><span class="p">(</span><span class="n">password</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">32</span><span class="p">),</span>
<span class="w">            </span><span class="p">:</span><span class="n">password</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="mi">512</span>
<span class="w">    </span><span class="p">)</span>
</code></pre>
</div>
<h2 id="security-considerations">
 Security considerations
</h2>
<p>
 Please never store passwords in plaintext in a database. You should always hash your passwords with a secure one-way
function like the ones in the SHA2 family. Use randomly generated salts with a length at least equal to the hash of the
password itself. Salts should be per-password, that meaning every time a password changes, the salt must change, and
therefore salts must be stored in the database alongside the passwords they were used for. Application-wide salts can
be used (by just concatenating them to the input of the hash function), but should never replace per-password salts,
used instead as an additional security measure.
</p>
<p>
 One way hashing algorithms like MD5 or SHA1 are considered insecure and should therefore be avoided.
</p>
<h2 id="the-passwordverify-module">
 The PasswordVerify module
</h2>
<p>
 Users and passwords have to be set in the database by other means than the PasswordVerify module.
</p>
<p>
 For example:
</p>
<div class="highlight">
 <pre><span></span><code><span class="w">    </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">uid</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">,</span>
<span class="w">      </span><span class="n">passwordhash</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">givenName</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">email</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">      </span><span class="n">eduPersonPrincipalName</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span>
<span class="w">    </span><span class="p">);</span>
</code></pre>
</div>
<p>
 A user can be added with a known password "FIXMEPASSWORD" as shown below.
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">$dsn = "pgsql:host=...";</span>
<span class="x">$username = "fixme";</span>
<span class="x">$password = "";</span>
<span class="x">$options = array();</span>

<span class="x">$query = "insert into users values ('test@example.com',:passwordhash, 'test', 'test@example.com', 'test@example.com' )";</span>

<span class="x">$db = new PDO($dsn, $username, $password, $options);</span>
<span class="x">$db-&gt;exec("SET NAMES 'UTF8'");</span>

<span class="x">$params = ["passwordhash" =&gt; password_hash("FIXMEPASSWORD", PASSWORD_ARGON2ID ) ];</span>
<span class="x">$sth = $db-&gt;prepare($query);</span>
<span class="x">$sth-&gt;execute($params);</span>
</code></pre>
</div>
<p>
 Since the above is using the default passwordhash column name this can
then be used with the following addition to authsources.php.
</p>
<div class="highlight">
 <pre><span></span><code><span class="x">'smalldb-dbauth' =&gt; [</span>
<span class="x">    'sqlauth:PasswordVerify',</span>
<span class="x">    'dsn' =&gt; 'pgsql:host=...',</span>
<span class="x">    'username' =&gt; 'dbuser',</span>
<span class="x">    'password' =&gt; 'dbpassword',</span>
<span class="x">    'passwodhashcolumn' =&gt;  'passwordhash',</span>
<span class="x">    'query' =&gt; 'select uid, email, passwordhash, eduPersonPrincipalName from users where uid = :username ',</span>
<span class="x">],</span>
</code></pre>
</div>
</main></body>
</html>
