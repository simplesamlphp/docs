<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleSAMLphp Documentation</title>

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
</head>
<body>
<header>
 <div id="header">
  <div class="right">
   <form action="https://www.google.com/cse" method="get" style="margin-top: 2.5rem; margin-right: 2rem">
    <input name="cx" type="hidden" value="004202914224971217557:8ks4jjstupq"/>
    <input name="siteurl" type="hidden" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq"/>
    <input name="adkw" type="hidden" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4"/>
    <input name="q" placeholder="Search" type="search" value=""/>
   </form>
  </div>
  <div class="v-center logo-header">
   <div id="logo">
    <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
     <span class="simple">
      Simple
     </span>
     <span class="saml">
      SAML
     </span>
     <span class="simple">
      php
     </span>
    </a>
   </div>
  </div>
 </div>
 <!-- Grey header bar below -->
 <nav>
  <div id="headerbar" style="clear: both">
   <p id="breadcrumb">
    <a href="https://simplesamlphp.org">
     Home
    </a>
    Â» Documentation
   </p>
   <div class="mtoolbar">
    <div class="menuitem first">
     <a href="/docs/latest/index.html">
      latest
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.19/index.html">
      1.19
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.18/index.html">
      1.18
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.17/index.html">
      1.17
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.16/index.html">
      1.16
     </a>
    </div>
    <div class="menuitem last">
     <a href="/docs/contributed_modules.html">
      Contributed modules
     </a>
    </div>
   </div>
   <br style="height: 0px; clear: both"/>
  </div>
  <!-- /#headerbar -->
 </nav>
 <div id="content">
 </div>
</header><main><h1 id="simplesamlphp-sp-api-reference">
 SimpleSAMLphp SP API reference
</h1>
<div class="toc">
 <ul>
  <li>
   <a href="#simplesamlphp-sp-api-reference">
    SimpleSAMLphp SP API reference
   </a>
   <ul>
    <li>
     <a href="#note-on-php-sessions-and-simplesamlphp-api-calls">
      Note on PHP sessions and SimpleSAMLphp API calls
     </a>
    </li>
    <li>
     <a href="#constructor">
      Constructor
     </a>
     <ul>
      <li>
       <a href="#parameters">
        Parameters
       </a>
      </li>
      <li>
       <a href="#example">
        Example
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a href="#isauthenticated">
      isAuthenticated
     </a>
     <ul>
      <li>
       <a href="#example_1">
        Example
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a href="#requireauth">
      requireAuth
     </a>
     <ul>
      <li>
       <a href="#parameters_1">
        Parameters
       </a>
      </li>
      <li>
       <a href="#example-1">
        Example 1
       </a>
      </li>
      <li>
       <a href="#example-2">
        Example 2
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a href="#login">
      login
     </a>
     <ul>
      <li>
       <a href="#parameters_2">
        Parameters
       </a>
      </li>
      <li>
       <a href="#example_2">
        Example
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a href="#logout">
      logout
     </a>
     <ul>
      <li>
       <a href="#parameters_3">
        Parameters
       </a>
      </li>
      <li>
       <a href="#example-1_1">
        Example 1
       </a>
      </li>
      <li>
       <a href="#example-2_1">
        Example 2
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a href="#getattributes">
      getAttributes
     </a>
     <ul>
      <li>
       <a href="#example_3">
        Example
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a href="#getauthdata">
      getAuthData
     </a>
     <ul>
      <li>
       <a href="#example_4">
        Example
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a href="#getloginurl">
      getLoginURL
     </a>
     <ul>
      <li>
       <a href="#parameters_4">
        Parameters
       </a>
      </li>
      <li>
       <a href="#example_5">
        Example
       </a>
      </li>
      <li>
       <a href="#note">
        Note
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a href="#getlogouturl">
      getLogoutURL
     </a>
     <ul>
      <li>
       <a href="#parameters_5">
        Parameters
       </a>
      </li>
      <li>
       <a href="#example_6">
        Example
       </a>
      </li>
      <li>
       <a href="#note_1">
        Note
       </a>
      </li>
     </ul>
    </li>
   </ul>
  </li>
 </ul>
</div>
<p>
 This document describes the \SimpleSAML\Auth\Simple API.
This is the preferred API for integrating SimpleSAMLphp with other applications.
</p>
<h3 id="note-on-php-sessions-and-simplesamlphp-api-calls">
 Note on PHP sessions and SimpleSAMLphp API calls
</h3>
<p>
 Some SimpleSAMLphp calls replace the current active PHP session. If you previously started a session and wish to write to it, then you must cleanup the SimpleSAMLphp session before you can write to your session. If you do not need to modify your own session, then you can leave the cleanup call out; however, forgetting to call cleanup is a common source of hard to find bugs.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="x">session_start();</span>
<span class="x">// ...</span>
<span class="x">$auth = new \SimpleSAML\Auth\Simple('default-sp');</span>
<span class="x">$auth-&gt;isAuthenticated(); // Replaces our session with the SimpleSAMLphp one</span>
<span class="x">// $_SESSION['key'] = 'value'; // This would save to the SimpleSAMLphp session which isn't what we want</span>
<span class="x">SimpleSAML_Session::getSessionFromRequest()-&gt;cleanup(); // Reverts to our PHP session</span>
<span class="x">// Save to our session</span>
<span class="x">$_SESSION['key'] = 'value';</span>
</code></pre>
</div>
<h2 id="constructor">
 Constructor
</h2>
<div class="codehilite">
 <pre><span></span><code><span class="x">new \SimpleSAML\Auth\Simple(string $authSource)</span>
</code></pre>
</div>
<p>
 The constructor initializes a \SimpleSAML\Auth\Simple object.
</p>
<h3 id="parameters">
 Parameters
</h3>
<p>
 It has a single parameter, which is the ID of the authentication source that should be used.
This authentication source must exist in
 <code>
  config/authsources.php
 </code>
 .
</p>
<h3 id="example">
 Example
</h3>
<div class="codehilite">
 <pre><span></span><code><span class="x">$auth = new \SimpleSAML\Auth\Simple('default-sp');</span>
</code></pre>
</div>
<h2 id="isauthenticated">
 <code>
  isAuthenticated
 </code>
</h2>
<div class="codehilite">
 <pre><span></span><code><span class="x">bool isAuthenticated()</span>
</code></pre>
</div>
<p>
 Check whether the user is authenticated with this authentication source.
 <code>
  TRUE
 </code>
 is returned if the user is authenticated,
 <code>
  FALSE
 </code>
 if not.
</p>
<h3 id="example_1">
 Example
</h3>
<div class="codehilite">
 <pre><span></span><code><span class="x">if (!$auth-&gt;isAuthenticated()) {</span>
<span class="x">    SimpleSAML_Session::getSessionFromRequest()-&gt;cleanup();</span>
<span class="x">    /* Show login link. */</span>
<span class="x">    print('&lt;a href="/login"&gt;Login&lt;/a&gt;');</span>
<span class="x">}</span>
</code></pre>
</div>
<h2 id="requireauth">
 <code>
  requireAuth
 </code>
</h2>
<div class="codehilite">
 <pre><span></span><code><span class="x">void requireAuth(array $params = [])</span>
</code></pre>
</div>
<p>
 Make sure that the user is authenticated.
This function will only return if the user is authenticated.
If the user isn't authenticated, this function will start the authentication process.
</p>
<h3 id="parameters_1">
 Parameters
</h3>
<p>
 <code>
  $params
 </code>
 is an associative array with named parameters for this function.
See the documentation for the
 <code>
  login
 </code>
 -function for a description of the parameters.
</p>
<h3 id="example-1">
 Example 1
</h3>
<div class="codehilite">
 <pre><span></span><code><span class="x">$auth-&gt;requireAuth();</span>
<span class="x">SimpleSAML_Session::getSessionFromRequest()-&gt;cleanup();</span>
<span class="x">print("Hello, authenticated user!");</span>
</code></pre>
</div>
<h3 id="example-2">
 Example 2
</h3>
<div class="codehilite">
 <pre><span></span><code><span class="x">/*</span>
<span class="x"> * Return the user to the frontpage after authentication, don't post</span>
<span class="x"> * the current POST data.</span>
<span class="x"> */</span>
<span class="x">$auth-&gt;requireAuth([</span>
<span class="x">    'ReturnTo' =&gt; 'https://sp.example.org/',</span>
<span class="x">    'KeepPost' =&gt; FALSE,</span>
<span class="x">]);</span>
<span class="x">SimpleSAML_Session::getSessionFromRequest()-&gt;cleanup();</span>
<span class="x">print("Hello, authenticated user!");</span>
</code></pre>
</div>
<h2 id="login">
 <code>
  login
 </code>
</h2>
<div class="codehilite">
 <pre><span></span><code><span class="x">void login(array $params = [])</span>
</code></pre>
</div>
<p>
 Start a login operation.
This function will always start a new authentication process.
</p>
<h3 id="parameters_2">
 Parameters
</h3>
<p>
 The following global parameters are supported:
</p>
<dl>
 <dt>
  <code>
   ErrorURL
  </code>
  (
  <code>
   string
  </code>
  )
 </dt>
 <dd>
  <p>
   A URL to a page which will receive errors that may occur during authentication.
  </p>
 </dd>
 <dt>
  <code>
   KeepPost
  </code>
  (
  <code>
   bool
  </code>
  )
 </dt>
 <dd>
  <p>
   If set to
   <code>
    TRUE
   </code>
   , the current POST data will be submitted again after authentication.
  The default is
   <code>
    TRUE
   </code>
   .
  </p>
 </dd>
 <dt>
  <code>
   ReturnTo
  </code>
  (
  <code>
   string
  </code>
  )
 </dt>
 <dd>
  <p>
   The URL the user should be returned to after authentication.
  The default is to return the user to the current page.
  </p>
 </dd>
 <dt>
  <code>
   ReturnCallback
  </code>
  (
  <code>
   array
  </code>
  )
 </dt>
 <dd>
  <p>
   The function we should call when the user finishes authentication.
  </p>
 </dd>
</dl>
<p>
 The
 <a href="./saml/sp.html">
  <code>
   saml:SP
  </code>
 </a>
 authentication source also defines some parameters.
</p>
<h3 id="example_2">
 Example
</h3>
<div class="codehilite">
 <pre><span></span><code><span class="x"># Send a passive authentication request.</span>
<span class="x">$auth-&gt;login([</span>
<span class="x">    'isPassive' =&gt; TRUE,</span>
<span class="x">     'ErrorURL' =&gt; 'https://.../error_handler.php',</span>
<span class="x"> ]);</span>
<span class="x"> SimpleSAML_Session::getSessionFromRequest()-&gt;cleanup();</span>
</code></pre>
</div>
<h2 id="logout">
 <code>
  logout
 </code>
</h2>
<div class="codehilite">
 <pre><span></span><code><span class="x">void logout(mixed $params = NULL)</span>
</code></pre>
</div>
<p>
 Log the user out.
After logging out, the user will either be redirected to another page, or a function will be called.
This function never returns.
</p>
<h3 id="parameters_3">
 Parameters
</h3>
<dl>
 <dt>
  <code>
   $params
  </code>
 </dt>
 <dd>
  Parameters for the logout operation.
  This can either be a simple string, in which case it is interpreted as the URL the user should be redirected to after logout, or an associative array with logout parameters.
  If this parameter isn't specified, we will redirect the user to the current URL after logout.
  <div class="codehilite">
   <pre><span></span><code><span class="k">If</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="k">array</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">following</span><span class="w"> </span><span class="k">options</span><span class="o">:</span><span class="w"></span>

<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`ReturnTo`</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">URL</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">returned</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">logout</span><span class="p">.</span><span class="w"></span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`ReturnCallback`</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">called</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">logout</span><span class="p">.</span><span class="w"></span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`ReturnStateParam`</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">we</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">redirecting</span><span class="p">.</span><span class="w"></span>
<span class="o">-</span><span class="w"> </span><span class="n n-Quoted">`ReturnStateStage`</span><span class="o">:</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">stage</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="k">array</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">saved</span><span class="w"> </span><span class="k">with</span><span class="p">.</span><span class="w"></span>

<span class="n">The</span><span class="w"> </span><span class="n n-Quoted">`ReturnState`</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">allow</span><span class="w"> </span><span class="n">access</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">logout</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="k">after</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">completes</span><span class="p">.</span><span class="w"></span>
</code></pre>
  </div>
 </dd>
</dl>
<h3 id="example-1_1">
 Example 1
</h3>
<p>
 Logout, and redirect to the specified URL.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="x">$auth-&gt;logout('https://sp.example.org/logged_out.php');</span>
<span class="x">SimpleSAML_Session::getSessionFromRequest()-&gt;cleanup();</span>
</code></pre>
</div>
<h3 id="example-2_1">
 Example 2
</h3>
<p>
 Same as the previous, but check the result of the logout operation afterwards.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="x">$auth-&gt;logout([</span>
<span class="x">    'ReturnTo' =&gt; 'https://sp.example.org/logged_out.php',</span>
<span class="x">    'ReturnStateParam' =&gt; 'LogoutState',</span>
<span class="x">    'ReturnStateStage' =&gt; 'MyLogoutState',</span>
<span class="x">]);</span>
<span class="x">SimpleSAML_Session::getSessionFromRequest()-&gt;cleanup();</span>
</code></pre>
</div>
<p>
 And in logged_out.php:
</p>
<div class="codehilite">
 <pre><span></span><code><span class="x">$state = \SimpleSAML\Auth\State::loadState((string)$_REQUEST['LogoutState'], 'MyLogoutState');</span>
<span class="x">$ls = $state['saml:sp:LogoutStatus']; /* Only works for SAML SP */</span>
<span class="x">if ($ls['Code'] === 'urn:oasis:names:tc:SAML:2.0:status:Success' &amp;&amp; !isset($ls['SubCode'])) {</span>
<span class="x">    /* Successful logout. */</span>
<span class="x">    echo("You have been logged out.");</span>
<span class="x">} else {</span>
<span class="x">    /* Logout failed. Tell the user to close the browser. */</span>
<span class="x">    echo("We were unable to log you out of all your sessions. To be completely sure that you are logged out, you need to close your web browser.");</span>
<span class="x">}</span>
</code></pre>
</div>
<h2 id="getattributes">
 <code>
  getAttributes
 </code>
</h2>
<div class="codehilite">
 <pre><span></span><code><span class="x">array getAttributes()</span>
</code></pre>
</div>
<p>
 Retrieve the attributes of the current user.
If the user isn't authenticated, an empty array will be returned.
</p>
<p>
 The attributes will be returned as an associative array with the name of the attribute as the key and the value as an array of one or more strings:
</p>
<div class="codehilite">
 <pre><span></span><code><span class="x">[</span>
<span class="x">    'uid' =&gt; ['testuser'],</span>
<span class="x">    'eduPersonAffiliation' =&gt; ['student', 'member'],</span>
<span class="x">]</span>
</code></pre>
</div>
<h3 id="example_3">
 Example
</h3>
<div class="codehilite">
 <pre><span></span><code><span class="x">$attrs = $auth-&gt;getAttributes();</span>
<span class="x">if (!isset($attrs['displayName'][0])) {</span>
<span class="x">    throw new Exception('displayName attribute missing.');</span>
<span class="x">}</span>
<span class="x">$name = $attrs['displayName'][0];</span>

<span class="x">print('Hello, ' . htmlspecialchars($name));</span>
</code></pre>
</div>
<h2 id="getauthdata">
 <code>
  getAuthData
 </code>
</h2>
<div class="codehilite">
 <pre><span></span><code><span class="x">mixed getAuthData(string $name)</span>
</code></pre>
</div>
<p>
 Retrieve the specified authentication data for the current session.
NULL is returned if the user isn't authenticated.
</p>
<p>
 The available authentication data depends on the module used for authentication.
See the
 <a href="./saml/sp.html">
  <code>
   saml:SP
  </code>
 </a>
 reference for information about available SAML authentication data.
</p>
<h3 id="example_4">
 Example
</h3>
<div class="codehilite">
 <pre><span></span><code><span class="x">$idp = $auth-&gt;getAuthData('saml:sp:IdP');</span>
<span class="x">$nameID = $auth-&gt;getAuthData('saml:sp:NameID')-&gt;getValue();</span>
<span class="x">printf('You are %s, logged in from %s', htmlspecialchars($nameID), htmlspecialchars($idp));</span>
</code></pre>
</div>
<h2 id="getloginurl">
 <code>
  getLoginURL
 </code>
</h2>
<div class="codehilite">
 <pre><span></span><code><span class="x">string getLoginURL(string $returnTo = NULL)</span>
</code></pre>
</div>
<p>
 Retrieve a URL that can be used to start authentication.
</p>
<h3 id="parameters_4">
 Parameters
</h3>
<dl>
 <dt>
  <code>
   $returnTo
  </code>
 </dt>
 <dd>
  <p>
   The URL the user should be returned to after authentication.
  The default is the current page.
  </p>
 </dd>
</dl>
<h3 id="example_5">
 Example
</h3>
<div class="codehilite">
 <pre><span></span><code><span class="x">$url = $auth-&gt;getLoginURL();</span>

<span class="x">print('&lt;a href="' . htmlspecialchars($url) . '"&gt;Login&lt;/a&gt;');</span>
</code></pre>
</div>
<h3 id="note">
 Note
</h3>
<p>
 The URL returned by this function is static, and will not change.
You can easily create your own links without using this function.
The URL should be:
</p>
<div class="codehilite">
 <pre><span></span><code>   ...<span class="o">/</span><span class="nv">simplesaml</span><span class="o">/</span><span class="nv">module</span>.<span class="nv">php</span><span class="o">/</span><span class="nv">core</span><span class="o">/</span><span class="nv">login</span><span class="o">/&lt;</span><span class="nv">authentication</span> <span class="nv">source</span><span class="o">&gt;</span>?<span class="nv">ReturnTo</span><span class="o">=&lt;</span><span class="k">return</span> <span class="nv">URL</span><span class="o">&gt;</span>
</code></pre>
</div>
<h2 id="getlogouturl">
 <code>
  getLogoutURL
 </code>
</h2>
<div class="codehilite">
 <pre><span></span><code><span class="x">string getLogoutURL(string $returnTo = NULL)</span>
</code></pre>
</div>
<p>
 Retrieve a URL that can be used to trigger logout.
</p>
<h3 id="parameters_5">
 Parameters
</h3>
<dl>
 <dt>
  <code>
   $returnTo
  </code>
 </dt>
 <dd>
  <p>
   The URL the user should be returned to after logout.
  The default is the current page.
  </p>
 </dd>
</dl>
<h3 id="example_6">
 Example
</h3>
<div class="codehilite">
 <pre><span></span><code><span class="x">$url = $auth-&gt;getLogoutURL();</span>

<span class="x">print('&lt;a href="' . htmlspecialchars($url) . '"&gt;Logout&lt;/a&gt;');</span>
</code></pre>
</div>
<h3 id="note_1">
 Note
</h3>
<p>
 The URL returned by this function is static, and will not change.
You can easily create your own links without using this function.
The URL should be:
</p>
<div class="codehilite">
 <pre><span></span><code>   ...<span class="o">/</span><span class="nv">simplesaml</span><span class="o">/</span><span class="nv">module</span>.<span class="nv">php</span><span class="o">/</span><span class="nv">core</span><span class="o">/</span><span class="nv">logout</span><span class="o">/&lt;</span><span class="nv">authentication</span> <span class="nv">source</span><span class="o">&gt;</span>?<span class="nv">ReturnTo</span><span class="o">=&lt;</span><span class="k">return</span> <span class="nv">URL</span><span class="o">&gt;</span>
</code></pre>
</div></main></body>
</html>
