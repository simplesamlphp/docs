<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleSAMLphp Documentation</title>

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
</head>
<body>
<header>
 <div id="header">
  <div class="right">
   <form action="https://www.google.com/cse" method="get" style="margin-top: 2.5rem; margin-right: 2rem">
    <input name="cx" type="hidden" value="004202914224971217557:8ks4jjstupq"/>
    <input name="siteurl" type="hidden" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq"/>
    <input name="adkw" type="hidden" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4"/>
    <input name="q" placeholder="Search" type="search" value=""/>
   </form>
  </div>
  <div class="v-center logo-header">
   <div id="logo">
    <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
     <span class="simple">
      Simple
     </span>
     <span class="saml">
      SAML
     </span>
     <span class="simple">
      php
     </span>
    </a>
   </div>
  </div>
 </div>
 <!-- Grey header bar below -->
 <nav>
  <div id="headerbar" style="clear: both">
   <p id="breadcrumb">
    <a href="https://simplesamlphp.org">
     Home
    </a>
    Â» Documentation
   </p>
   <div class="mtoolbar">
    <div class="menuitem">
     <a href="/docs/2.3/index.html">
      2.3 (stable)
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/2.2/index.html">
      2.2
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/2.1/index.html">
      2.1
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/2.0/index.html">
      2.0
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.19/index.html">
      1.19
     </a>
    </div>
    <div class="menuitem first">
     <a href="/docs/devel/index.html">
      devel
     </a>
    </div>
    <div class="menuitem last">
     <a href="/docs/contributed_modules.html">
      Contributed modules
     </a>
    </div>
   </div>
   <br style="height: 0px; clear: both"/>
  </div>
  <!-- /#headerbar -->
 </nav>
 <div id="content">
 </div>
</header>
<main><h1 id="scoping">
 Scoping
</h1>
<div class="toc">
 <ul>
  <li>
   <a href="#scoping">
    Scoping
   </a>
   <ul>
    <li>
     <a href="#options">
      Options
     </a>
     <ul>
      <li>
       <a href="#usage">
        Usage
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a href="#retrieving-information">
      Retrieving information
     </a>
     <ul>
      <li>
       <a href="#requesterid-element">
        RequesterID element
       </a>
      </li>
      <li>
       <a href="#authenticatingauthority-element">
        AuthenticatingAuthority element
       </a>
      </li>
     </ul>
    </li>
    <li>
     <a href="#support">
      Support
     </a>
    </li>
   </ul>
  </li>
 </ul>
</div>
<p>
 Scoping allows a service provider to specify a list of identity providers in an
authnRequest to a proxying identity provider. This is an indication to the
proxying identity provider that the service will only deal with the identity
providers specified.
</p>
<p>
 A common use is for a service provider in a hub-and-spoke architecture to
manage its own discovery service and being able to tell the hub/proxy-IdP which
(backend-end) identity provider to use. The standard discovery service in
SimpleSAMLphp will show the intersection of all the known IdPs and the IdPs
specified in the scoping element. If this intersection only contains one IdP,
then the request is automatically forwarded to that IdP.
</p>
<p>
 Scoping is a SAML 2.0 specific option.
</p>
<h2 id="options">
 Options
</h2>
<p>
 SimpleSAMLphp supports scoping by allowing the following options:
</p>
<dl>
 <dt>
  <code>
   ProxyCount
  </code>
 </dt>
 <dd>
  Specifies the number of proxying indirections permissible
between the identity provider receiving the request and the identity provider
who ultimately authenticates the user. A count of zero permits no proxying. If
ProxyCount is unspecified the number of proxy indirections is not limited.
 </dd>
 <dt>
  <code>
   IDPList
  </code>
 </dt>
 <dd>
  The list of trusted IdPs, i.e. the list of entityIDs for identity providers
that are relevant for a service provider in an authnRequest.
 </dd>
</dl>
<p>
 <strong>
  Note
 </strong>
 : SimpleSAMLphp does not support specifying the GetComplete option.
</p>
<h3 id="usage">
 Usage
</h3>
<p>
 The ProxyCount and IDPList option can be specified in the following places:
</p>
<ul>
 <li>
  as a state parameter to the authentication source
 </li>
 <li>
  in the saml:SP authentication source configuration
 </li>
 <li>
  in the saml20-idp-remote metadata
 </li>
 <li>
  in the saml20-sp-remote metadata
 </li>
</ul>
<p>
 Example configuration:
</p>
<div class="codehilite">
 <pre><span></span><code>  # Add the IDPList
  'IDPList' =&gt; [
      'IdPEntityID1',
      'IdPEntityID2',
      'IdPEntityID3',
  ],

  # Set ProxyCount
  'ProxyCount' =&gt; 2,
</code></pre>
</div>
<h2 id="retrieving-information">
 Retrieving information
</h2>
<h3 id="requesterid-element">
 RequesterID element
</h3>
<p>
 To allow an identity provider to identify the original requester and the
proxying identity providers, SimpleSAMLphp adds the RequesterID element to
the request and if necessary the scoping element even if explicit scoping is
not used.
</p>
<p>
 The RequesterId elements are available from the state array as an array, for
instance via the authenticate method on an authentication source.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="w">  </span><span class="o">$</span><span class="nt">requesterIDs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">$</span><span class="nt">state</span><span class="cp">[</span><span class="s1">'saml:RequesterID'</span><span class="cp">]</span><span class="o">;</span>
</code></pre>
</div>
<h3 id="authenticatingauthority-element">
 AuthenticatingAuthority element
</h3>
<p>
 To allow a service provider to identify the authentication authorities that
were involved in the authentication of the user, SimpleSAMLphp adds the
AuthenticatingAuthority elements.
</p>
<p>
 The list of authenticating authorities (the AuthenticatingAuthority element)
can be retrieved as an array from the authentication data.
</p>
<div class="codehilite">
 <pre><span></span><code><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">Get</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">authentication</span><span class="w"> </span><span class="nx">source</span><span class="p">.</span>
<span class="w">  </span><span class="err">$</span><span class="k">as</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="err">\</span><span class="nx">SimpleSAML</span><span class="err">\</span><span class="nx">Auth</span><span class="err">\</span><span class="nx">Simple</span><span class="p">();</span>

<span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">Get</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">AuthenticatingAuthority</span>
<span class="w">  </span><span class="err">$</span><span class="nx">aa</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="err">$</span><span class="k">as</span><span class="o">-&gt;</span><span class="nx">getAuthData</span><span class="p">(</span><span class="err">'</span><span class="nx">saml</span><span class="p">:</span><span class="nx">AuthenticatingAuthority</span><span class="err">'</span><span class="p">);</span>
</code></pre>
</div>
<h2 id="support">
 Support
</h2>
<p>
 If you need help to make this work, or want to discuss SimpleSAMLphp with other users of the software, you are fortunate: Around SimpleSAMLphp there is a great Open source community, and you are welcome to join! The forums are open for you to ask questions, contribute answers other further questions, request improvements or contribute with code or plugins of your own.
</p>
<ul>
 <li>
  <a href="https://simplesamlphp.org">
   SimpleSAMLphp homepage
  </a>
 </li>
 <li>
  <a href="https://simplesamlphp.org/docs/">
   List of all available SimpleSAMLphp documentation
  </a>
 </li>
 <li>
  <a href="https://simplesamlphp.org/lists">
   Join the SimpleSAMLphp user's mailing list
  </a>
 </li>
</ul>
</main></body>
</html>
