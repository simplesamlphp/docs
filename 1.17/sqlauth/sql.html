<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleSAMLphp Documentation</title>

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
</head>
<body>
<header>
 <div id="header">
  <div class="right">
   <form action="https://www.google.com/cse" method="get" style="margin-top: 2.5rem; margin-right: 2rem">
    <input name="cx" type="hidden" value="004202914224971217557:8ks4jjstupq"/>
    <input name="siteurl" type="hidden" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq"/>
    <input name="adkw" type="hidden" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4"/>
    <input name="q" placeholder="Search" type="search" value=""/>
   </form>
  </div>
  <div class="v-center logo-header">
   <div id="logo">
    <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
     <span class="simple">
      Simple
     </span>
     <span class="saml">
      SAML
     </span>
     <span class="simple">
      php
     </span>
    </a>
   </div>
  </div>
 </div>
 <!-- Grey header bar below -->
 <nav>
  <div id="headerbar" style="clear: both">
   <p id="breadcrumb">
    <a href="https://simplesamlphp.org">
     Home
    </a>
    Â» Documentation
   </p>
   <div class="mtoolbar">
    <div class="menuitem">
     <a href="/docs/1.19/index.html">
      1.19 (stable)
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.18/index.html">
      1.18
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.17/index.html">
      1.17
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.16/index.html">
      1.16
     </a>
    </div>
    <div class="menuitem first">
     <a href="/docs/devel/index.html">
      devel
     </a>
    </div>
    <div class="menuitem last">
     <a href="/docs/contributed_modules.html">
      Contributed modules
     </a>
    </div>
   </div>
   <br style="height: 0px; clear: both"/>
  </div>
  <!-- /#headerbar -->
 </nav>
 <div id="content">
 </div>
</header><main><h1 id="sqlauthsql">
 <code>
  sqlauth:SQL
 </code>
</h1>
<p>
 This is a authentication module for authenticating an user against a SQL database.
</p>
<h2 id="options">
 Options
</h2>
<dl>
 <dt>
  <code>
   dsn
  </code>
 </dt>
 <dd>
  The DSN which should be used to connect to the database server.
  Check the various database drivers in the
  <a href="http://php.net/manual/en/pdo.drivers.php">
   PHP documentation
  </a>
  for a description of the various DSN formats.
 </dd>
 <dt>
  <code>
   username
  </code>
 </dt>
 <dd>
  The username which should be used when connecting to the database server.
 </dd>
 <dt>
  <code>
   password
  </code>
 </dt>
 <dd>
  The password which should be used when connecting to the database server.
 </dd>
 <dt>
  <code>
   query
  </code>
 </dt>
 <dd>
  The SQL query which should be used to retrieve the user.
  The parameters :username and :password are available.
  If the username/password is incorrect, the query should return no rows.
  The name of the columns in resultset will be used as attribute names.
  If the query returns multiple rows, they will be merged into the attributes.
  Duplicate values and NULL values will be removed.
 </dd>
</dl>
<h2 id="examples">
 Examples
</h2>
<p>
 Database layout used in some of the examples:
</p>
<div class="codehilite">
 <pre><span></span><code>  CREATE TABLE users (
    uid VARCHAR(30) NOT NULL PRIMARY KEY,
    password TEXT NOT NULL,
    salt TEXT NOT NULL,
    givenName TEXT NOT NULL,
    email TEXT NOT NULL,
    eduPersonPrincipalName TEXT NOT NULL
  );
  CREATE TABLE usergroups (
    uid VARCHAR(30) NOT NULL REFERENCES users (uid) ON DELETE CASCADE ON UPDATE CASCADE,
    groupname VARCHAR(30) NOT NULL,
    UNIQUE(uid, groupname)
  );
</code></pre>
</div>
<p>
 Example query - SHA256 of salt + password, with the salt stored in an independent column, MySQL server:
</p>
<div class="codehilite">
 <pre><span></span><code>  SELECT uid, givenName, email, eduPersonPrincipalName
  FROM users
  WHERE uid = :username
  AND PASSWORD = SHA2(
      CONCAT(
          (SELECT salt FROM users WHERE uid = :username),
          :password
      ),
      256
  )
</code></pre>
</div>
<p>
 Example query - SHA256 of salt + password, with the salt stored in an independent column. Multiple groups, MySQL server:
</p>
<div class="codehilite">
 <pre><span></span><code>  SELECT users.uid, givenName, email, eduPersonPrincipalName, groupname AS groups
  FROM users LEFT JOIN usergroups ON users.uid = usergroups.username
  WHERE users.uid = :username
  AND PASSWORD = SHA2(
      CONCAT(
          (SELECT salt FROM users WHERE uid = :username),
          :password
      ),
      256
  )
</code></pre>
</div>
<p>
 Example query - SHA512 of salt + password, stored as salt (32 bytes) + sha256(salt + password) in password-field, PostgreSQL server:
</p>
<div class="codehilite">
 <pre><span></span><code><span class="w">  </span><span class="nv">SELECT</span><span class="w"> </span><span class="nv">uid</span>,<span class="w"> </span><span class="nv">givenName</span>,<span class="w"> </span><span class="nv">email</span>,<span class="w"> </span><span class="nv">eduPersonPrincipalName</span><span class="w"></span>
<span class="w">  </span><span class="nv">FROM</span><span class="w"> </span><span class="nv">users</span><span class="w"></span>
<span class="w">  </span><span class="nv">WHERE</span><span class="w"> </span><span class="nv">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>:<span class="nv">username</span><span class="w"></span>
<span class="w">  </span><span class="nv">AND</span><span class="w"> </span><span class="nv">SUBSTRING</span><span class="ss">(</span><span class="w"></span>
<span class="w">      </span><span class="nv">password</span><span class="w"> </span><span class="nv">FROM</span><span class="w"> </span><span class="nv">LENGTH</span><span class="ss">(</span><span class="nv">password</span><span class="ss">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">31</span><span class="w"></span>
<span class="w">  </span><span class="ss">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">SHA2</span><span class="ss">(</span><span class="w"></span>
<span class="w">      </span><span class="nv">CONCAT</span><span class="ss">(</span><span class="w"></span>
<span class="w">          </span><span class="nv">SUBSTRING</span><span class="ss">(</span><span class="nv">password</span><span class="w"> </span><span class="nv">FROM</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">LENGTH</span><span class="ss">(</span><span class="nv">password</span><span class="ss">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">32</span><span class="ss">)</span>,<span class="w"></span>
<span class="w">          </span>:<span class="nv">password</span><span class="w"></span>
<span class="w">      </span><span class="ss">)</span>,<span class="w"></span>
<span class="w">      </span><span class="mi">512</span><span class="w"></span>
<span class="w">  </span><span class="ss">)</span><span class="w"></span>
</code></pre>
</div>
<h2 id="security-considerations">
 Security considerations
</h2>
<p>
 Please never store passwords in plaintext in a database. You should always hash your passwords with a secure one-way
function like the ones in the SHA2 family. Use randomly generated salts with a length at least equal to the hash of the
password itself. Salts should be per-password, that meaning every time a password changes, the salt must change, and
therefore salts must be stored in the database alongside the passwords they were used for. Application-wide salts can
be used (by just concatenating them to the input of the hash function), but should never replace per-password salts,
used instead as an additional security measure.
</p>
<p>
 One way hashing algorithms like MD5 or SHA1 are considered insecure and should therefore be avoided.
</p></main></body>
</html>
