<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SimpleSAMLphp Documentation</title>

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
</head>
<body>
<header>
 <div id="header">
  <div class="right">
   <form action="https://www.google.com/cse" method="get" style="margin-top: 2.5rem; margin-right: 2rem">
    <input name="cx" type="hidden" value="004202914224971217557:8ks4jjstupq"/>
    <input name="siteurl" type="hidden" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq"/>
    <input name="adkw" type="hidden" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4"/>
    <input name="q" placeholder="Search" type="search" value=""/>
   </form>
  </div>
  <div class="v-center logo-header">
   <div id="logo">
    <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
     <span class="simple">
      Simple
     </span>
     <span class="saml">
      SAML
     </span>
     <span class="simple">
      php
     </span>
    </a>
   </div>
  </div>
 </div>
 <!-- Grey header bar below -->
 <nav>
  <div id="headerbar" style="clear: both">
   <p id="breadcrumb">
    <a href="https://simplesamlphp.org">
     Home
    </a>
    Â» Documentation
   </p>
   <div class="mtoolbar">
    <div class="menuitem first">
     <a href="/docs/latest/index.html">
      latest
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.19/index.html">
      1.19
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.18/index.html">
      1.18
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.17/index.html">
      1.17
     </a>
    </div>
    <div class="menuitem">
     <a href="/docs/1.16/index.html">
      1.16
     </a>
    </div>
    <div class="menuitem last">
     <a href="/docs/contributed_modules.html">
      Contributed modules
     </a>
    </div>
   </div>
   <br style="height: 0px; clear: both"/>
  </div>
  <!-- /#headerbar -->
 </nav>
 <div id="content">
 </div>
</header><h1 id="simplesamlphp-sp-api-reference">
 SimpleSAMLphp SP API reference
</h1>
<!-- {{TOC}} -->
<p>
 This document describes the \SimpleSAML\Auth\Simple API.
This is the preferred API for integrating SimpleSAMLphp with other applications.
</p>
<h2 id="constructor">
 Constructor
</h2>
<pre class="codehilite"><code>  new \SimpleSAML\Auth\Simple(string $authSource)
</code></pre>
<p>
 The constructor initializes a \SimpleSAML\Auth\Simple object.
</p>
<h3 id="parameters">
 Parameters
</h3>
<p>
 It has a single parameter, which is the ID of the authentication source that should be used.
This authentication source must exist in
 <code>
  config/authsources.php
 </code>
 .
</p>
<h3 id="example">
 Example
</h3>
<pre class="codehilite"><code>  $auth = new \SimpleSAML\Auth\Simple('default-sp');
</code></pre>
<h2 id="isauthenticated">
 <code>
  isAuthenticated
 </code>
</h2>
<pre class="codehilite"><code>  bool isAuthenticated()
</code></pre>
<p>
 Check whether the user is authenticated with this authentication source.
 <code>
  TRUE
 </code>
 is returned if the user is authenticated,
 <code>
  FALSE
 </code>
 if not.
</p>
<h3 id="example_1">
 Example
</h3>
<pre class="codehilite"><code>  if (!$auth-&gt;isAuthenticated()) {
      /* Show login link. */
      print('&lt;a href="/login"&gt;Login&lt;/a&gt;');
  }
</code></pre>
<h2 id="requireauth">
 <code>
  requireAuth
 </code>
</h2>
<pre class="codehilite"><code>  void requireAuth(array $params = [])
</code></pre>
<p>
 Make sure that the user is authenticated.
This function will only return if the user is authenticated.
If the user isn't authenticated, this function will start the authentication process.
</p>
<h3 id="parameters_1">
 Parameters
</h3>
<p>
 <code>
  $params
 </code>
 is an associative array with named parameters for this function.
See the documentation for the
 <code>
  login
 </code>
 -function for a description of the parameters.
</p>
<h3 id="example-1">
 Example 1
</h3>
<pre class="codehilite"><code>  $auth-&gt;requireAuth();
  print("Hello, authenticated user!");
</code></pre>
<h3 id="example-2">
 Example 2
</h3>
<pre class="codehilite"><code>  /*
   * Return the user to the frontpage after authentication, don't post
   * the current POST data.
   */
  $auth-&gt;requireAuth([
      'ReturnTo' =&gt; 'https://sp.example.org/',
      'KeepPost' =&gt; FALSE,
  ]);
  print("Hello, authenticated user!");
</code></pre>
<h2 id="login">
 <code>
  login
 </code>
</h2>
<pre class="codehilite"><code>  void login(array $params = [])
</code></pre>
<p>
 Start a login operation.
This function will always start a new authentication process.
</p>
<h3 id="parameters_2">
 Parameters
</h3>
<p>
 The following global parameters are supported:
</p>
<dl>
 <dt>
  <code>
   ErrorURL
  </code>
  (
  <code>
   string
  </code>
  )
 </dt>
 <dd>
  <p>
   A URL to a page which will receive errors that may occur during authentication.
  </p>
 </dd>
 <dt>
  <code>
   KeepPost
  </code>
  (
  <code>
   bool
  </code>
  )
 </dt>
 <dd>
  <p>
   If set to
   <code>
    TRUE
   </code>
   , the current POST data will be submitted again after authentication.
  The default is
   <code>
    TRUE
   </code>
   .
  </p>
 </dd>
 <dt>
  <code>
   ReturnTo
  </code>
  (
  <code>
   string
  </code>
  )
 </dt>
 <dd>
  <p>
   The URL the user should be returned to after authentication.
  The default is to return the user to the current page.
  </p>
 </dd>
 <dt>
  <code>
   ReturnCallback
  </code>
  (
  <code>
   array
  </code>
  )
 </dt>
 <dd>
  <p>
   The function we should call when the user finishes authentication.
  </p>
 </dd>
</dl>
<p>
 The
 <a href="./saml/sp.html">
  <code>
   saml:SP
  </code>
 </a>
 authentication source also defines some parameters.
</p>
<h3 id="example_2">
 Example
</h3>
<pre class="codehilite"><code>  # Send a passive authentication request.
  $auth-&gt;login([
      'isPassive' =&gt; TRUE,
      'ErrorURL' =&gt; 'https://.../error_handler.php',
  ]);
</code></pre>
<h2 id="logout">
 <code>
  logout
 </code>
</h2>
<pre class="codehilite"><code>  void logout(mixed $params = NULL)
</code></pre>
<p>
 Log the user out.
After logging out, the user will either be redirected to another page, or a function will be called.
This function never returns.
</p>
<h3 id="parameters_3">
 Parameters
</h3>
<dl>
 <dt>
  <code>
   $params
  </code>
 </dt>
 <dd>
  Parameters for the logout operation.
  This can either be a simple string, in which case it is interpreted as the URL the user should be redirected to after logout, or an associative array with logout parameters.
  If this parameter isn't specified, we will redirect the user to the current URL after logout.
  <pre class="codehilite"><code>If the parameter is an an array, it can have the following options:

- `ReturnTo`: The URL the user should be returned to after logout.
- `ReturnCallback`: The function that should be called after logout.
- `ReturnStateParam`: The parameter we should return the state in when redirecting.
- `ReturnStateStage`: The stage the state array should be saved with.

The `ReturnState` parameters allow access to the result of the logout operation after it completes.
</code></pre>
 </dd>
</dl>
<h3 id="example-1_1">
 Example 1
</h3>
<p>
 Logout, and redirect to the specified URL.
</p>
<pre class="codehilite"><code>  $auth-&gt;logout('https://sp.example.org/logged_out.php');
</code></pre>
<h3 id="example-2_1">
 Example 2
</h3>
<p>
 Same as the previous, but check the result of the logout operation afterwards.
</p>
<pre class="codehilite"><code>  $auth-&gt;logout([
      'ReturnTo' =&gt; 'https://sp.example.org/logged_out.php',
      'ReturnStateParam' =&gt; 'LogoutState',
      'ReturnStateStage' =&gt; 'MyLogoutState',
  ]);
</code></pre>
<p>
 And in logged_out.php:
</p>
<pre class="codehilite"><code>  $state = \SimpleSAML\Auth\State::loadState((string)$_REQUEST['LogoutState'], 'MyLogoutState');
  $ls = $state['saml:sp:LogoutStatus']; /* Only works for SAML SP */
  if ($ls['Code'] === 'urn:oasis:names:tc:SAML:2.0:status:Success' &amp;&amp; !isset($ls['SubCode'])) {
      /* Successful logout. */
      echo("You have been logged out.");
  } else {
      /* Logout failed. Tell the user to close the browser. */
      echo("We were unable to log you out of all your sessions. To be completely sure that you are logged out, you need to close your web browser.");
  }
</code></pre>
<h2 id="getattributes">
 <code>
  getAttributes
 </code>
</h2>
<pre class="codehilite"><code>  array getAttributes()
</code></pre>
<p>
 Retrieve the attributes of the current user.
If the user isn't authenticated, an empty array will be returned.
</p>
<p>
 The attributes will be returned as an associative array with the name of the attribute as the key and the value as an array of one or more strings:
</p>
<pre class="codehilite"><code>  [
      'uid' =&gt; ['testuser'],
      'eduPersonAffiliation' =&gt; ['student', 'member'],
  ]
</code></pre>
<h3 id="example_3">
 Example
</h3>
<pre class="codehilite"><code>  $attrs = $auth-&gt;getAttributes();
  if (!isset($attrs['displayName'][0])) {
      throw new Exception('displayName attribute missing.');
  }
  $name = $attrs['displayName'][0];

  print('Hello, ' . htmlspecialchars($name));
</code></pre>
<h2 id="getauthdata">
 <code>
  getAuthData
 </code>
</h2>
<pre class="codehilite"><code>  mixed getAuthData(string $name)
</code></pre>
<p>
 Retrieve the specified authentication data for the current session.
NULL is returned if the user isn't authenticated.
</p>
<p>
 The available authentication data depends on the module used for authentication.
See the
 <a href="./saml/sp.html">
  <code>
   saml:SP
  </code>
 </a>
 reference for information about available SAML authentication data.
</p>
<h3 id="example_4">
 Example
</h3>
<pre class="codehilite"><code>  $idp = $auth-&gt;getAuthData('saml:sp:IdP');
  print('You are logged in from: ' . htmlspecialchars($idp));
</code></pre>
<h2 id="getloginurl">
 <code>
  getLoginURL
 </code>
</h2>
<pre class="codehilite"><code>  string getLoginURL(string $returnTo = NULL)
</code></pre>
<p>
 Retrieve a URL that can be used to start authentication.
</p>
<h3 id="parameters_4">
 Parameters
</h3>
<dl>
 <dt>
  <code>
   $returnTo
  </code>
 </dt>
 <dd>
  <p>
   The URL the user should be returned to after authentication.
  The default is the current page.
  </p>
 </dd>
</dl>
<h3 id="example_5">
 Example
</h3>
<pre class="codehilite"><code>  $url = $auth-&gt;getLoginURL();

  print('&lt;a href="' . htmlspecialchars($url) . '"&gt;Login&lt;/a&gt;');
</code></pre>
<h3 id="note">
 Note
</h3>
<p>
 The URL returned by this function is static, and will not change.
You can easily create your own links without using this function.
The URL should be:
</p>
<pre class="codehilite"><code>   .../simplesaml/module.php/core/as_login.php?AuthId=&lt;authentication source&gt;&amp;ReturnTo=&lt;return URL&gt;
</code></pre>
<h2 id="getlogouturl">
 <code>
  getLogoutURL
 </code>
</h2>
<pre class="codehilite"><code>  string getLogoutURL(string $returnTo = NULL)
</code></pre>
<p>
 Retrieve a URL that can be used to trigger logout.
</p>
<h3 id="parameters_5">
 Parameters
</h3>
<dl>
 <dt>
  <code>
   $returnTo
  </code>
 </dt>
 <dd>
  <p>
   The URL the user should be returned to after logout.
  The default is the current page.
  </p>
 </dd>
</dl>
<h3 id="example_6">
 Example
</h3>
<pre class="codehilite"><code>  $url = $auth-&gt;getLogoutURL();

  print('&lt;a href="' . htmlspecialchars($url) . '"&gt;Logout&lt;/a&gt;');
</code></pre>
<h3 id="note_1">
 Note
</h3>
<p>
 The URL returned by this function is static, and will not change.
You can easily create your own links without using this function.
The URL should be:
</p>
<pre class="codehilite"><code>   .../simplesaml/module.php/core/as_logout.php?AuthId=&lt;authentication source&gt;&amp;ReturnTo=&lt;return URL&gt;
</code></pre></body>
</html>
